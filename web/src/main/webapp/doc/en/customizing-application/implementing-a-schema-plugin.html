<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Implementing schema plugins &mdash; GeoNetwork opensource v3.12 GeoNetwork Documentation</title>
      <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../_static/doctools.js"></script>
        <script src="../_static/sphinx_highlight.js"></script>
    <script src="../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Characterset" href="characterset.html" />
    <link rel="prev" title="Adding static pages" href="adding-static-pages.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../index.html" class="icon icon-home"> GeoNetwork opensource
          </a>
              <div class="version">
                3.12
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../overview/index.html">Overview</a></li>
<li class="toctree-l1"><a class="reference internal" href="../install-guide/index.html">Installation guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../user-guide/index.html">User guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../administrator-guide/index.html">Administrator guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../maintainer-guide/index.html">Maintainer guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../api/index.html">API guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../contributing/index.html">Contributing guide</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="index.html">Customizing guide</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="search-ui/index.html">Search application</a></li>
<li class="toctree-l2"><a class="reference internal" href="creating-custom-view.html">Customizing metadata views</a></li>
<li class="toctree-l2"><a class="reference internal" href="editor-ui/creating-custom-editor.html">Customizing editor</a></li>
<li class="toctree-l2"><a class="reference internal" href="changing-layout.html">Theming</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuring-search-fields.html">Configuring search fields</a></li>
<li class="toctree-l2"><a class="reference internal" href="configuring-faceted-search.html">Configuring faceted search</a></li>
<li class="toctree-l2"><a class="reference internal" href="advanced-configuration.html">Advanced configuration</a></li>
<li class="toctree-l2"><a class="reference internal" href="adding-static-pages.html">Adding static pages</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Implementing schema plugins</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#metadata-schemas-and-profiles">Metadata schemas and profiles</a></li>
<li class="toctree-l3"><a class="reference internal" href="#implementing-a-metadata-schema-or-profile">Implementing a metadata schema or profile</a></li>
<li class="toctree-l3"><a class="reference internal" href="#schema-plugins">Schema Plugins</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#contents-of-a-geonetwork-schema">Contents of a GeoNetwork schema</a></li>
<li class="toctree-l4"><a class="reference internal" href="#preparation">Preparation</a></li>
<li class="toctree-l4"><a class="reference internal" href="#example-iso19115-19139-marine-community-profile-mcp">Example - ISO19115/19139 Marine Community Profile (MCP)</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="characterset.html">Characterset</a></li>
<li class="toctree-l2"><a class="reference internal" href="misc.html">Miscellaneous</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../tutorials/index.html">Tutorials</a></li>
<li class="toctree-l1"><a class="reference internal" href="../annexes/index.html">Annexes</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">GeoNetwork opensource</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="index.html">Customizing guide</a> &raquo;</li>
      <li>Implementing schema plugins</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/geonetwork/doc/blob/develop/source/customizing-application/implementing-a-schema-plugin.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="implementing-schema-plugins">
<span id="implementing-a-schema-plugin"></span><h1>Implementing schema plugins<a class="headerlink" href="#implementing-schema-plugins" title="Permalink to this heading">¶</a></h1>
<section id="metadata-schemas-and-profiles">
<h2>Metadata schemas and profiles<a class="headerlink" href="#metadata-schemas-and-profiles" title="Permalink to this heading">¶</a></h2>
<p>A metadata schema describes:</p>
<ol class="arabic simple">
<li><p>the names, descriptions and any value codelists of the elements in the metadata schema</p></li>
<li><p>how the elements of the metadata schema are laid out in a metadata document (structure)</p></li>
<li><p>constraints on elements and content in a metadata document</p></li>
<li><p>documentation on how the elements of the metadata schema should be used</p></li>
<li><p>sample metadata documents and metadata templates</p></li>
<li><p>scripts to convert metadata documents to and from other metadata schemas</p></li>
</ol>
<p>A metadata schema is usually an implementation of a metadata standard.</p>
<p>A metadata profile is an adaptation of a metadata schema to suit the needs
of a particular community. A metadata profile contains all the components of
a metadata schema but may extend, restrict or redefine these components.</p>
</section>
<section id="implementing-a-metadata-schema-or-profile">
<h2>Implementing a metadata schema or profile<a class="headerlink" href="#implementing-a-metadata-schema-or-profile" title="Permalink to this heading">¶</a></h2>
<p>There are many ways in which a metadata schema or profile can be implemented.
This section will describe the way in which metadata schemas are implemented
on <a class="reference external" href="https://github.com/geonetwork/schema-plugins">https://github.com/geonetwork/schema-plugins</a> or <a class="reference external" href="https://github.com/metadata101">https://github.com/metadata101</a>.</p>
<p>Each metadata schema is a Maven module implemented as a filesystem tree.
The root of the tree is the name of the metadata schema in abbreviated form.
The essential components of a metadata schema in the
<code class="docutils literal notranslate"><span class="pre">src/main/plugin/&lt;schema_id&gt;</span></code> folder and are laid out as follows:</p>
<ol class="arabic simple">
<li><p><strong>loc</strong> directory with sub-directories for each three letter language code
that this information is localized into, with the content in XML files
(labels.xml, codelists.xml).  For example: <code class="docutils literal notranslate"><span class="pre">loc/eng/codelists.xml</span></code>
describes the english codelists for metadata elements</p></li>
<li><p><strong>schema</strong> directory and file named <strong>schema.xsd</strong> providing a single
entry point to the XSD hierarchy.  For example: <code class="docutils literal notranslate"><span class="pre">schema/gmd/gmd.xsd</span></code></p></li>
<li><p><strong>schematron</strong> directory has constraints on elements and content in a
metadata document implemented using the ISO schematron language</p></li>
<li><p><strong>docs</strong> directory has documentation on how the elements of the metadata
schema should be used.</p></li>
<li><p><strong>sample-data</strong> directory has sample metadata documents</p></li>
<li><p><strong>convert</strong> directory has XSLTs that convert metadata documents to and
from other schemas</p></li>
</ol>
<p>More information on the content of these directories and files will be given
in the next section.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>Some schemas on <a class="reference external" href="https://github.com/geonetwork/schema-plugins">https://github.com/geonetwork/schema-plugins</a>
or <a class="reference external" href="https://github.com/metadata101">https://github.com/metadata101</a> have more information
than described above because they have been implemented as GeoNetwork schema plugins.</p>
</div>
</section>
<section id="schema-plugins">
<h2>Schema Plugins<a class="headerlink" href="#schema-plugins" title="Permalink to this heading">¶</a></h2>
<p>A schema plugin that can be used in GeoNetwork is a directory of stylesheets,
XML schema descriptions (XSDs) and other information necessary for GeoNetwork
to index, view and possibly edit content from XML metadata records.</p>
<p>To be used in GeoNetwork, a schema directory can be manually placed in the
<code class="docutils literal notranslate"><span class="pre">schema_plugins</span></code> sub directory of the GeoNetwork data directory. For some schema
an additional JAR file should be added to the WEB-INF/lib folder. The default
GeoNetwork data directory location is <code class="docutils literal notranslate"><span class="pre">INSTALL_DIR/web/geonetwork/WEB-INF/data</span></code>.</p>
<p>The contents of these schemas are parsed during GeoNetwork initialization.
If valid, they will be available for use when GeoNetwork starts up.</p>
<p>Schemas can also added to GeoNetwork dynamically if a zip archive of the
schema directory is created and then uploaded to GeoNetwork in one of following
ways using functions in the Administration menu:</p>
<ol class="arabic simple">
<li><p>Server file path (specified using file chooser)</p></li>
<li><p>HTTP URL (eg. <a class="reference external" href="http://somehost/somedirectory/iso19139.mcp.zip">http://somehost/somedirectory/iso19139.mcp.zip</a>)</p></li>
<li><p>As an online resource attached to an ISO19115/19139 metadata record</p></li>
</ol>
<p>Uploaded schemas are also stored in the <code class="docutils literal notranslate"><span class="pre">schema_plugins</span></code> sub directory of the
GeoNetwork data directory.</p>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>A template module is available here <a class="reference external" href="https://github.com/geonetwork/schema-plugins/tree/develop/iso19139.xyz">https://github.com/geonetwork/schema-plugins/tree/develop/iso19139.xyz</a>
and is a good example to start with.</p>
</div>
<section id="contents-of-a-geonetwork-schema">
<h3>Contents of a GeoNetwork schema<a class="headerlink" href="#contents-of-a-geonetwork-schema" title="Permalink to this heading">¶</a></h3>
<p>When installed, a GeoNetwork schema is a directory.</p>
<p>The following sub-directories can be present in <code class="docutils literal notranslate"><span class="pre">src/main/plugin/&lt;schema_id&gt;</span></code>:</p>
<ul class="simple">
<li><p><strong>schema</strong>: (<em>Optional</em>) Directory containing the official XSDs of the metadata
schema. If the schema is described by a DTD then this directory is optional.
Note that schemas described by a DTD cannot be edited by GeoNetwork.</p></li>
<li><p><strong>schematron</strong>: (<em>Optional</em>) Directory containing the schematrons used to check
conditions on content.</p></li>
<li><p><strong>docs</strong>: (<em>Optional</em>) Documentation about the schema</p></li>
<li><p><strong>index-fields</strong>: (<em>Mandatory</em>) Directory of XSLT required to index metadata record.</p></li>
<li><p><strong>loc</strong>: (<em>Mandatory</em>) Directory of localized information: labels, codelists
or schema specific strings. Eg. <code class="docutils literal notranslate"><span class="pre">loc/eng/codelists.xml</span></code></p></li>
<li><p><strong>convert</strong>: (<em>Mandatory</em>) Directory of XSLTs to convert metadata from or
to this schema. This could be to convert metadata to other schemas or to
convert metadata from other schemas and formats to this schema.
Eg. <code class="docutils literal notranslate"><span class="pre">convert/oai_dc.xsl</span></code></p></li>
<li><p><strong>layout</strong>: (<em>Mandatory for version 3.x</em>) contains configuration for
presenting metadata in the editor.</p></li>
<li><p><strong>formatter</strong>: (<em>Optional for version 3.x</em>) contains configuration for
presenting metadata using Groovy or XSLT formatter.</p></li>
<li><p><strong>present</strong>: (<em>Mandatory for version 2.x</em>) contains XSLTs for
presenting metadata in the viewer/editor.</p></li>
<li><p><strong>present/csw</strong>: (<em>Mandatory</em>) contains XSLTs for response to CSW requests
for brief, summary and full records.</p></li>
<li><p><strong>process</strong>: (<em>Optional</em>) contains XSLTs for processing metadata elements by
metadata suggestions mechanism (see <strong>suggest.xsl</strong> below).</p></li>
<li><p><strong>sample-data</strong>: (<em>Optional</em>) Sample metadata for this schema. The metadata
samples are in MEF format so that samples can have thumbnails or browse graphics
as well as online resources.</p></li>
<li><p><strong>templates</strong>: (<em>Optional</em>) Directory containing template and subtemplate metadata
records for this schema. Template metadata records are usually metadata records
with the set of elements (and content) that will be used for a specific purpose.
Eg. iso19139.mcp schema has a ‘Minimum Element’ template that has the mandatory
elements for the schema and a example of the content that is expected.</p></li>
</ul>
<p>The following stylesheets can be present:</p>
<ul class="simple">
<li><p><strong>extract-date-modified.xsl</strong>: (<em>Mandatory</em>) Extract the date of modification
from the metadata record.</p></li>
<li><p><strong>extract-gml.xsl</strong>: (<em>Mandatory</em>) Extract the spatial extent from the
metadata record as a GML GeometryCollection element.</p></li>
<li><p><strong>extract-thumbnails.xsl</strong>: (<em>Optional</em>) Extract the browse graphic/thumbnail
from the metadata record.</p></li>
<li><p><strong>extract-uuid.xsl</strong>: (<em>Mandatory</em>) Extract the UUID of the metadata record.</p></li>
<li><p><strong>extract-relations.xsl</strong>: (<em>Optional</em>) Extract the associated resources of
the metadata record (eg. online source, thumbnails).</p></li>
<li><p><strong>set-thumbnail.xsl</strong>: (<em>Optional</em>) Set the browse graphic/thumbnail
in the metadata record.</p></li>
<li><p><strong>set-uuid.xsl</strong>: (<em>Optional</em>) Set the UUID of the metadata record.</p></li>
<li><p><strong>suggest.xsl</strong>: (<em>Optional</em>) XSLT run by metadata suggestions service.
The XSLT contains processes that can be registered and run on different
elements of a metadata record. eg. expand keyword field with comma separated
content into multiple keyword fields.
See <a class="reference internal" href="../user-guide/workflow/suggestion.html#metadata-suggestion"><span class="std std-ref">Suggestions for improving metadata content</span></a> for more info.</p></li>
<li><p><strong>unset-thumbnail.xsl</strong>: (<em>Optional</em>) Remove the browse graphic/thumbnail from
the metadata record.</p></li>
<li><p><strong>update-child-from-parent-info.xsl</strong>: (<em>Optional</em>) XSLT to specify which
elements in a child record are updated from a parent record. Used to manage
hierarchical relationships between metadata records.</p></li>
<li><p><strong>update-fixed-info.xsl</strong>: (<em>Optional</em>) XSLT to update ‘fixed’ content in metadata records.</p></li>
</ul>
<p>The following configuration files can be present:</p>
<ul class="simple">
<li><p><strong>oasis-catalog.xml</strong>: (<em>Optional</em>) An oasis catalog describing any mappings
that should be used for this schema eg. mapping URLs to local copies such as
schemaLocations eg. <a class="reference external" href="http://www.isotc211.org/2005/gmd/gmd.xsd">http://www.isotc211.org/2005/gmd/gmd.xsd</a> is mapped to
<code class="docutils literal notranslate"><span class="pre">schema/gmd/gmd.xsd</span></code>. Path names used in the oasis catalog are relative to
the location of this file which is the schema directory.</p></li>
<li><p><strong>schema.xsd</strong>: (<em>Optional</em>) XML schema directory file that includes the XSDs
used by this metadata schema. If the schema uses a DTD then this file should
not be present. Metadata records from schemas that use DTDs cannot be edited in GeoNetwork.</p></li>
<li><p><strong>schema-conversions.xml</strong>: (<em>Optional</em>) XML file that describes the
converters that can be applied to records belonging to this schema. This
information is used to show these conversions as options for the user to
choose when a metadata record belonging to this schema is shown in the search results.</p></li>
<li><p><strong>schema-ident.xml</strong>: (<em>Mandatory</em>) XML file that contains the schema name,
identifier, version number and details on how to recognise metadata records
that belong to this schema. This file has an XML schema
definition in <code class="docutils literal notranslate"><span class="pre">INSTALL_DIR/web/geonetwork/xml/validation/schemaPlugins/schema-ident.xsd</span></code>
which is used to validate it when the schema is loaded.</p></li>
<li><p><strong>schema-substitutes.xml</strong>: (<em>Optional</em>) XML file that redefines the set of elements
that can be used as substitutes for a specific element.</p></li>
<li><p><strong>schema-suggestions.xml</strong>: (<em>Optional</em>) XML file that tells the editor which
child elements of a complex element to automatically expand in the editor.</p></li>
</ul>
<p>In the <code class="docutils literal notranslate"><span class="pre">index-fields</span></code> folder, the following files are required:</p>
<ul class="simple">
<li><p><strong>default.xsl</strong>: (<em>Mandatory</em>) Index the metadata record content in
Lucene. Creates the Lucene document used by GeoNetwork to index the metadata record content.</p></li>
<li><p><strong>language-default.xsl</strong>: (<em>Optional</em>) Required to index multilingual metadata</p></li>
</ul>
<p>To help in understanding what each of these components is and what is required,
we will now give a step-by-step example of how to build a schemaPlugin for GeoNetwork.</p>
</section>
<section id="preparation">
<span id="id1"></span><h3>Preparation<a class="headerlink" href="#preparation" title="Permalink to this heading">¶</a></h3>
<p>In order to create a schema plugin for GeoNetwork, you should check out the
source code:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>--recursive<span class="w"> </span>https://github.com/geonetwork/core-geonetwork
</pre></div>
</div>
<p>Then you could check out the schema plugin repository containing examples:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>git<span class="w"> </span>clone<span class="w"> </span>--recursive<span class="w"> </span>https://github.com/geonetwork/schema-plugins
</pre></div>
</div>
<p>To work with the example shown here, you should create your new schema plugin
in a sub-directory of the schemas Maven module (see <a class="reference external" href="https://github.com/geonetwork/core-geonetwork/tree/master/schemas">source file schemas</a>). The
<code class="docutils literal notranslate"><span class="pre">iso19139.xyz</span></code> plugin from the schema plugin repository could be a good start.</p>
<p>Once created, you need to register your new plugin in the build of the application.
To do this:</p>
<ul class="simple">
<li><p>Add the plugin as a module of the schemas module (see <a class="reference external" href="https://github.com/geonetwork/core-geonetwork/tree/master/schemas/pom.xml">source file schemas/pom.xml</a>):</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;module&gt;</span>iso19139.xyz<span class="nt">&lt;/module&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Register the plugin in the webapp in the <code class="docutils literal notranslate"><span class="pre">copy-schemas</span></code> execution (see <a class="reference external" href="https://github.com/geonetwork/core-geonetwork/tree/master/web/pom.xml">source file web/pom.xml</a>):</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;resource&gt;</span>
<span class="w">   </span><span class="nt">&lt;directory&gt;</span>${project.basedir}/../schemas/iso19139.xyz/src/main/plugin<span class="nt">&lt;/directory&gt;</span>
<span class="w">   </span><span class="nt">&lt;targetPath&gt;</span>${basedir}/src/main/webapp/WEB-INF/data/config/schema_plugins<span class="nt">&lt;/targetPath&gt;</span>
<span class="w"> </span><span class="nt">&lt;/resource&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>Optionally register the dependency if you plugin implement custom Java (see <a class="reference external" href="https://github.com/geonetwork/core-geonetwork/tree/master/web/pom.xml">source file web/pom.xml</a>):</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;dependency&gt;</span>
<span class="w">  </span><span class="nt">&lt;groupId&gt;</span>${project.groupId}<span class="nt">&lt;/groupId&gt;</span>
<span class="w">  </span><span class="nt">&lt;artifactId&gt;</span>schema-iso19139.xyz<span class="nt">&lt;/artifactId&gt;</span>
<span class="w">  </span><span class="nt">&lt;version&gt;</span>${project.version}<span class="nt">&lt;/version&gt;</span>
<span class="nt">&lt;/dependency&gt;</span>
</pre></div>
</div>
</section>
<section id="example-iso19115-19139-marine-community-profile-mcp">
<h3>Example - ISO19115/19139 Marine Community Profile (MCP)<a class="headerlink" href="#example-iso19115-19139-marine-community-profile-mcp" title="Permalink to this heading">¶</a></h3>
<p>The Marine Community Profile (MCP) is a profile of ISO19115/19139 developed for
and with the Marine Community. The profile extends the ISO19115 metadata standard
and is implemented using an extension of the XML implementation of ISO19115 described
in ISO19139. Both the ISO19115 metadata standard and its XML implementation,
ISO19139, are available through ISO distribution channels.</p>
<p>The documentation for the Marine Community Profile can be found at
<a class="reference external" href="http://www.aodc.gov.au/files/MarineCommunityProfilev1.4.pdf">http://www.aodc.gov.au/files/MarineCommunityProfilev1.4.pdf</a>. The implementation
of the Marine Community Profile as XML schema definitions is based on the approach
described at <a class="reference external" href="https://www.seegrid.csiro.au/wiki/AppSchemas/MetadataProfiles">https://www.seegrid.csiro.au/wiki/AppSchemas/MetadataProfiles</a>. The XML
schema definitions (XSDs) are available at the URL <a class="reference external" href="http://bluenet3.antcrc.utas.edu.au/mcp-1.4">http://bluenet3.antcrc.utas.edu.au/mcp-1.4</a>.</p>
<p>Looking at the XML schema definitions, the profile adds a few new elements to the base
ISO19139 standard. So the basic idea in defining a plugin Marine Community Profile
schema for GeoNetwork is to use as much of the basic ISO19139 schema definition
supplied with GeoNetwork as possible.</p>
<p>We’ll now describe in basic steps how to create each of the components of a plugin
schema for GeoNetwork that implements the MCP.</p>
<section id="creating-the-schema-ident-xml-file">
<h4>Creating the schema-ident.xml file<a class="headerlink" href="#creating-the-schema-ident-xml-file" title="Permalink to this heading">¶</a></h4>
<p>Now we need to provide the information necessary to identify the schema
and metadata records that belong to the schema. The schema-ident.xml file for the
MCP is as follows:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>
<span class="nt">&lt;schema</span><span class="w"> </span><span class="na">xmlns=</span><span class="s">&quot;http://geonetwork-opensource.org/schemas/schema-ident&quot;</span>
<span class="w">        </span><span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;name&gt;</span>iso19139.mcp<span class="nt">&lt;/name&gt;</span>
<span class="w">  </span><span class="nt">&lt;id&gt;</span>19c9a2b2-dddb-11df-9df4-001c2346de4c<span class="nt">&lt;/id&gt;</span>
<span class="w">  </span><span class="nt">&lt;version&gt;</span>1.5<span class="nt">&lt;/version&gt;</span>
<span class="w">  </span><span class="nt">&lt;schemaLocation&gt;</span>
<span class="w">    </span>http://bluenet3.antcrc.utas.edu.au/mcp
<span class="w">    </span>http://bluenet3.antcrc.utas.edu.au/mcp-1.5-experimental/schema.xsd
<span class="w">    </span>http://www.isotc211.org/2005/gmd
<span class="w">    </span>http://www.isotc211.org/2005/gmd/gmd.xsd
<span class="w">    </span>http://www.isotc211.org/2005/srv
<span class="w">    </span>http://schemas.opengis.net/iso/19139/20060504/srv/srv.xsd
<span class="w">  </span><span class="nt">&lt;/schemaLocation&gt;</span>
<span class="w">  </span><span class="nt">&lt;autodetect</span><span class="w"> </span><span class="na">xmlns:mcp=</span><span class="s">&quot;http://bluenet3.antcrc.utas.edu.au/mcp&quot;</span>
<span class="w">              </span><span class="na">xmlns:gmd=</span><span class="s">&quot;http://www.isotc211.org/2005/gmd&quot;</span>
<span class="w">              </span><span class="na">xmlns:gco=</span><span class="s">&quot;http://www.isotc211.org/2005/gco&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;elements&gt;</span>
<span class="w">      </span><span class="nt">&lt;gmd:metadataStandardName&gt;</span>
<span class="w">        </span><span class="nt">&lt;gco:CharacterString&gt;</span>
<span class="w">          </span>Australian<span class="w"> </span>Marine<span class="w"> </span>Community<span class="w"> </span>Profile<span class="w"> </span>of<span class="w"> </span>ISO<span class="w"> </span>19115:2005/19139|
<span class="w">          </span>Marine<span class="w"> </span>Community<span class="w"> </span>Profile<span class="w"> </span>of<span class="w"> </span>ISO<span class="w"> </span>19115:2005/19139
<span class="w">        </span><span class="nt">&lt;/gco:CharacterString&gt;</span>
<span class="w">      </span><span class="nt">&lt;/gmd:metadataStandardName&gt;</span>
<span class="w">      </span><span class="nt">&lt;gmd:metadataStandardVersion&gt;</span>
<span class="w">        </span><span class="nt">&lt;gco:CharacterString&gt;</span>
<span class="w">          </span>1.5-experimental|
<span class="w">          </span>MCP:BlueNet<span class="w"> </span>V1.5-experimental|
<span class="w">          </span>MCP:BlueNet<span class="w"> </span>V1.5
<span class="w">        </span><span class="nt">&lt;/gco:CharacterString&gt;</span>
<span class="w">      </span><span class="nt">&lt;/gmd:metadataStandardVersion&gt;</span>
<span class="w">    </span><span class="nt">&lt;/elements&gt;</span>
<span class="w">  </span><span class="nt">&lt;/autodetect&gt;</span>
<span class="nt">&lt;/schema&gt;</span>
</pre></div>
</div>
<p>Each of the elements is as follows:</p>
<ul class="simple">
<li><p><strong>name</strong> - the name by which the schema will be known in GeoNetwork. If the
schema is a profile of a base schema already added to GeoNetwork then the
convention is to call the schema &lt;base_schema_name&gt;.&lt;namespace_of_profile&gt;.</p></li>
<li><p><strong>id</strong> - a unique identifier for the schema.</p></li>
<li><p><strong>version</strong> - the version number of the schema. Multiple versions of the
schema can be present in GeoNetwork.</p></li>
<li><p><strong>schemaLocation</strong> - a set of pairs, where the first member of the pair is a
namespace URI and the second member is the official URL of the XSD. The
contents of this element will be added to the root element of any metadata
record displayed by GeoNetwork as a schemaLocation/noNamespaceSchemaLocation
attribute, if such as attribute does not already exist. It will also be used
whenever an official schemaLocation/noNamespaceSchemaLocation is
required (eg. in response to a ListMetadataFormats OAI request).</p></li>
<li><p><strong>autodetect</strong> - contains elements or attributes (with content) that must
be present in any metadata record that belongs to this schema. This is
used during schema detection whenever GeoNetwork receives a metadata
record of unknown schema.</p></li>
<li><p><strong>filters</strong> - (Optional) contains custom filter to be applied based on user privileges</p></li>
</ul>
<p>After creating this file you can validate it manually using the XML schema
definition (XSD) in <code class="docutils literal notranslate"><span class="pre">INSTALL_DIR/web/geonetwork/xml/validation/schemaPlugins/schema-ident.xsd</span></code>.
This XSD is also used to validate this file when the schema is loaded.
If schema-ident.xml fails validation, the schema will not be loaded.</p>
</section>
<section id="more-on-autodetect">
<h4>More on autodetect<a class="headerlink" href="#more-on-autodetect" title="Permalink to this heading">¶</a></h4>
<p>The autodetect section of schema-ident.xml is used when GeoNetwork needs to
identify which metadata schema a record belongs to.</p>
<p>The five rules that can be used in this section in order of evaluation are:</p>
<p><strong>1. Attributes</strong> - Find one or more attributes and/or namespaces in the document.
An example use case is a profile of ISO19115/19139 that adds optional elements
under a new namespace to gmd:identificationInfo/gmd:MD_DataIdentification.
To detect records that belong to this profile the autodetect section in the
schema-ident.xml file could look something like the following:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;autodetect</span><span class="w"> </span><span class="na">xmlns:cmar=</span><span class="s">&quot;http://www.marine.csiro.au/schemas/cmar.xsd&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- catch all cmar records that have the cmar vocab element --&gt;</span>
<span class="w">  </span><span class="nt">&lt;attributes</span><span class="w"> </span><span class="na">cmar:vocab=</span><span class="s">&quot;http://www.marine.csiro.au/vocabs/projectCodes.xml&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/autodetect&gt;</span>
</pre></div>
</div>
<p>Some other points about attributes autodetect:</p>
<ul class="simple">
<li><p>multiple attributes can be specified - all must be match for the record to
be recognized as belonging to this schema.</p></li>
<li><p>if the attributes have a namespace then the namespace should be specified on
the autodetect element or somewhere in the schema-ident.xml document.</p></li>
</ul>
<p><strong>2. Elements</strong> - Find one or more elements in the document. An example use case
is the one shown in the example schema-ident.xml file earlier:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;autodetect</span><span class="w"> </span><span class="na">xmlns:mcp=</span><span class="s">&quot;http://bluenet3.antcrc.utas.edu.au/mcp&quot;</span>
<span class="w">            </span><span class="na">xmlns:gmd=</span><span class="s">&quot;http://www.isotc211.org/2005/gmd&quot;</span>
<span class="w">            </span><span class="na">xmlns:gco=</span><span class="s">&quot;http://www.isotc211.org/2005/gco&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;elements&gt;</span>
<span class="w">    </span><span class="nt">&lt;gmd:metadataStandardName&gt;</span>
<span class="w">      </span><span class="nt">&lt;gco:CharacterString&gt;</span>
<span class="w">        </span>Australian<span class="w"> </span>Marine<span class="w"> </span>Community<span class="w"> </span>Profile<span class="w"> </span>of<span class="w"> </span>ISO<span class="w"> </span>19115:2005/19139|
<span class="w">        </span>Marine<span class="w"> </span>Community<span class="w"> </span>Profile<span class="w"> </span>of<span class="w"> </span>ISO<span class="w"> </span>19115:2005/19139
<span class="w">      </span><span class="nt">&lt;/gco:CharacterString&gt;</span>
<span class="w">    </span><span class="nt">&lt;/gmd:metadataStandardName&gt;</span>
<span class="w">    </span><span class="nt">&lt;gmd:metadataStandardVersion&gt;</span>
<span class="w">      </span><span class="nt">&lt;gco:CharacterString&gt;</span>
<span class="w">        </span>1.5-experimental|
<span class="w">        </span>MCP:BlueNet<span class="w"> </span>V1.5-experimental|
<span class="w">        </span>MCP:BlueNet<span class="w"> </span>V1.5
<span class="w">      </span><span class="nt">&lt;/gco:CharacterString&gt;</span>
<span class="w">    </span><span class="nt">&lt;/gmd:metadataStandardVersion&gt;</span>
<span class="w">  </span><span class="nt">&lt;/elements&gt;</span>
<span class="nt">&lt;/autodetect&gt;</span>
</pre></div>
</div>
<p>Some other points about elements autodetect:</p>
<ul class="simple">
<li><p>multiple elements can be specified - eg. as in the above, both
metadataStandardName and metadataStandardVersion have been specified - all
must be match for the record to be recognized as belonging to this schema.</p></li>
<li><p>multiple values for the elements can be specified. eg. as in the above,
a match for gmd:metadataStandardVersion will be found for <code class="docutils literal notranslate"><span class="pre">1.5-experimental</span></code>
OR <code class="docutils literal notranslate"><span class="pre">MCP:BlueNet</span> <span class="pre">V1.5-experimental</span></code> OR <code class="docutils literal notranslate"><span class="pre">MCP:BlueNet</span> <span class="pre">V1.5</span></code> - the vertical
line or pipe character ‘|’ is used to separate the options here. Regular
expression can be used also.</p></li>
<li><p>if the elements have a namespace then the namespace(s) should be specified
on the autodetect element or somewhere in the schema-ident.xml document before
the element in which they are used - eg. in the above there are there
namespace declarations on the autodetect element so as not to
clutter the content.</p></li>
</ul>
<p><strong>3. Root element</strong> - root element of the document must match. An example use
case is the one used for the eml-gbif schema. Documents belonging to this
schema always have root element of eml:eml so the autodetect section
for this schema is:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;autodetect</span><span class="w"> </span><span class="na">xmlns:eml=</span><span class="s">&quot;eml://ecoinformatics.org/eml-2.1.1&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;elements</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;root&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;eml:eml/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/elements&gt;</span>
<span class="nt">&lt;/autodetect&gt;</span>
</pre></div>
</div>
<p>Some other points about root element autodetect:</p>
<ul class="simple">
<li><p>multiple elements can be specified - any element in the set that matches
the root element of the record will trigger a match.</p></li>
<li><p>if the elements have a namespace then the namespace(s) should be specified on
the autodetect element or somewhere in the schema-ident.xml document before
the element that uses them - eg. as in the above there is a namespace
declaration on the autodetect element for clarity.</p></li>
</ul>
<p><strong>4. Namespaces</strong> - Find one or more namespaces in the document. An example use
case is the one used for the csw:Record schema. Records belonging to the
csw:Record schema can have three possible root elements: csw:Record,
csw:SummaryRecord and csw:BriefRecord, but instead of using a multiple
element root autodetect, we could use the common csw namespace
for autodetect as follows:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;autodetect&gt;</span>
<span class="w">  </span><span class="nt">&lt;namespaces</span><span class="w"> </span><span class="na">xmlns:csw=</span><span class="s">&quot;http://www.opengis.net/cat/csw/2.0.2&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/autodetect&gt;</span>
</pre></div>
</div>
<p>Some other points about namespaces autodetect:</p>
<ul class="simple">
<li><p>multiple namespaces can be specified - all must be present for the record to
be recognized as belonging to this schema.</p></li>
<li><p>the prefix is ignored. A namespace match occurs if the namespace URI found
in the record matches the namespace URI specified in the namespaces
autodetect element.</p></li>
</ul>
<p><strong>5. Default schema</strong> - This is the fail-safe provision for records that don’t
match any of the installed schemas. The value for the default schema is
specified in the appHandler configuration of the
<code class="docutils literal notranslate"><span class="pre">INSTALL_DIR/web/geonetwork/WEB-INF/config.xml</span></code> config file or it could
be a default specified by the operation calling autodetect
(eg. a value parsed from a user bulk loading some metadata records).
For flexibility and accuracy reasons it is preferable that records be
detected using the autodetect information of an installed schema.
The default schema is just a ‘catch all’ method of assigning records to
a specific schema. The config element in
<code class="docutils literal notranslate"><span class="pre">INSTALL_DIR/web/geonetwork/WEB-INF/config.xml</span></code> looks like the following:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;appHandler</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.fao.geonet.Geonetwork&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span>.....
<span class="w">  </span><span class="nt">&lt;param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;preferredSchema&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;iso19139&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">  </span>.....
<span class="nt">&lt;/appHandler&gt;</span>
</pre></div>
</div>
</section>
<section id="more-on-autodetect-evaluation">
<h4>More on autodetect evaluation<a class="headerlink" href="#more-on-autodetect-evaluation" title="Permalink to this heading">¶</a></h4>
<p>The rules for autodetect are evaluated as follows:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span><span class="k">for</span>-each<span class="w"> </span>autodetect<span class="w"> </span>rule<span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="o">(</span><span class="w"> </span><span class="s1">&#39;attributes/namespaces&#39;</span>,<span class="w"> </span><span class="s1">&#39;elements&#39;</span>,
<span class="w">                                   </span><span class="s1">&#39;namespaces&#39;</span>,<span class="w"> </span><span class="s1">&#39;root element&#39;</span><span class="w"> </span><span class="o">)</span>
<span class="w">  </span><span class="k">for</span>-each<span class="w"> </span>schema
<span class="w">    </span><span class="k">if</span><span class="w"> </span>schema<span class="w"> </span>has<span class="w"> </span>autodetect<span class="w"> </span>rule<span class="w"> </span><span class="nb">type</span><span class="w"> </span><span class="k">then</span>
<span class="w">      </span>check<span class="w"> </span>rule<span class="w"> </span><span class="k">for</span><span class="w"> </span>a<span class="w"> </span>match
<span class="w">      </span><span class="k">if</span><span class="w"> </span>match<span class="w"> </span>add<span class="w"> </span>to<span class="w"> </span>list<span class="w"> </span>of<span class="w"> </span>previous<span class="w"> </span>matches
<span class="w">    </span>end<span class="w"> </span><span class="k">if</span>
<span class="w">  </span>end<span class="w"> </span><span class="k">for</span>-each

<span class="w">  </span><span class="k">if</span><span class="w"> </span>more<span class="w"> </span>than<span class="w"> </span>one<span class="w"> </span>match<span class="w"> </span>throw<span class="w"> </span><span class="s1">&#39;SCHEMA RULE CONFLICT EXCEPTION&#39;</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span>one<span class="w"> </span>match<span class="w"> </span><span class="k">then</span><span class="w"> </span><span class="nb">set</span><span class="w"> </span><span class="nv">matched</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>first<span class="w"> </span>match<span class="w"> </span>and<span class="w"> </span><span class="k">break</span><span class="w"> </span>loop
end<span class="w"> </span><span class="k">for</span>-each

<span class="k">if</span><span class="w"> </span>no<span class="w"> </span>match<span class="w"> </span><span class="k">then</span>
<span class="w">  </span><span class="k">if</span><span class="w"> </span>namespaces<span class="w"> </span>of<span class="w"> </span>record<span class="w"> </span>and<span class="w"> </span>default<span class="w"> </span>schema<span class="w"> </span>overlap<span class="w"> </span><span class="k">then</span>
<span class="w">    </span><span class="nb">set</span><span class="w"> </span><span class="nv">match</span><span class="w"> </span><span class="o">=</span><span class="w"> </span>default<span class="w"> </span>schema
<span class="w">  </span><span class="k">else</span><span class="w"> </span>throw<span class="w"> </span><span class="s1">&#39;NO SCHEMA MATCHES EXCEPTION&#39;</span>
end<span class="w"> </span><span class="k">if</span>

<span class="k">return</span><span class="w"> </span>matched<span class="w"> </span>schema
</pre></div>
</div>
<p>As an example, suppose we have three schemas iso19139.mcp, iso19139.mcp-1.4
and iso19139.mcp-cmar with the following autodetect elements:</p>
<p><strong>iso19139.mcp-1.4:</strong></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;autodetect</span><span class="w"> </span><span class="na">xmlns:mcp=</span><span class="s">&quot;http://bluenet3.antcrc.utas.edu.au/mcp&quot;</span>
<span class="w">            </span><span class="na">xmlns:gmd=</span><span class="s">&quot;http://www.isotc211.org/2005/gmd&quot;</span>
<span class="w">            </span><span class="na">xmlns:gco=</span><span class="s">&quot;http://www.isotc211.org/2005/gco&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;elements&gt;</span>
<span class="w">    </span><span class="nt">&lt;gmd:metadataStandardName&gt;</span>
<span class="w">      </span><span class="nt">&lt;gco:CharacterString&gt;</span>
<span class="w">        </span>Australian<span class="w"> </span>Marine<span class="w"> </span>Community<span class="w"> </span>Profile<span class="w"> </span>of<span class="w"> </span>ISO<span class="w"> </span>19115:2005/19139
<span class="w">      </span><span class="nt">&lt;/gco:CharacterString&gt;</span>
<span class="w">    </span><span class="nt">&lt;/gmd:metadataStandardName&gt;</span>
<span class="w">    </span><span class="nt">&lt;gmd:metadataStandardVersion&gt;</span>
<span class="w">      </span><span class="nt">&lt;gco:CharacterString&gt;</span>MCP:BlueNet<span class="w"> </span>V1.4<span class="nt">&lt;/gco:CharacterString&gt;</span>
<span class="w">    </span><span class="nt">&lt;/gmd:metadataStandardVersion&gt;</span>
<span class="w">  </span><span class="nt">&lt;/elements&gt;</span>
<span class="nt">&lt;/autodetect&gt;</span>
</pre></div>
</div>
<p><strong>iso19139.mcp-cmar:</strong></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;autodetect&gt;</span>
<span class="w">    </span><span class="nt">&lt;attributes</span><span class="w"> </span><span class="na">xmlns:mcp-cmar=</span><span class="s">&quot;http://www.marine.csiro.au/schemas/mcp-cmar&quot;</span><span class="nt">&gt;</span>
<span class="nt">&lt;/autodetect&gt;</span>
</pre></div>
</div>
<p><strong>iso19139.mcp:</strong></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;autodetect</span><span class="w"> </span><span class="na">xmlns:mcp=</span><span class="s">&quot;http://bluenet3.antcrc.utas.edu.au/mcp&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;elements</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;root&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;mcp:MD_Metadata/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/elements&gt;</span>
<span class="nt">&lt;/autodetect&gt;</span>
</pre></div>
</div>
<p>A record going through autodetect processing (eg. on import) would be checked against:</p>
<ul class="simple">
<li><p>iso19139.mcp-cmar first as it has an ‘attributes’ rule</p></li>
<li><p>then iso19139.mcp-1.4 as it has an ‘elements’ rules</p></li>
<li><p>then finally against iso19139.mcp, as it has a ‘root element’ rule.</p></li>
</ul>
<p>The idea behind this processing algorithm is that base schemas will use a
‘root element’ rule (or the more difficult to control ‘namespaces’ rule) and
profiles will use a finer or more specific rule such as ‘attributes’ or ‘elements’.</p>
</section>
<section id="more-on-filters">
<h4>More on filters<a class="headerlink" href="#more-on-filters" title="Permalink to this heading">¶</a></h4>
<p>The goal is to add the capability to configure the download and dynamic
operation based on the catalog content where they could have different meanings depending :</p>
<ul class="simple">
<li><p>on the schema (eg. URL to a file for download is not located at
the same place for dublin core and ISO19139)</p></li>
<li><p>on the record encoding rules (eg. download could be WFS links and not only uploaded file).</p></li>
</ul>
<p>Filter configuration for each type of operation is defined in schema-ident.xml
in the filters section.</p>
<p>A filter define:</p>
<ul class="simple">
<li><p>an operation (which match canEdit, canDownload, canDynamic
method in AccessManager)</p></li>
<li><p>an XPath to select elements to filter</p></li>
<li><p>an optional element definition to substitute the replaced element
by (if a match is found this element attributes or children are inserted).
This is used to highlight removed element.</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;filters&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- Filter element having withheld nilReason for user who can not edit --&gt;</span>
<span class="w">  </span><span class="nt">&lt;filter</span><span class="w"> </span><span class="na">xpath=</span><span class="s">&quot;*//*[@gco:nilReason=&#39;withheld&#39;]&quot;</span>
<span class="w">          </span><span class="na">ifNotOperation=</span><span class="s">&quot;editing&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;keepMarkedElement</span><span class="w"> </span><span class="na">gco:nilReason=</span><span class="s">&quot;withheld&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/filter&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- Filter element having protocol download for user who can not download --&gt;</span>
<span class="w">  </span><span class="nt">&lt;filter</span><span class="w"> </span><span class="na">xpath=</span><span class="s">&quot;*//gmd:onLine[*/gmd:protocol/gco:CharacterString = &#39;WWW:DOWNLOAD-1.0-http--download&#39;]&quot;</span>
<span class="w">          </span><span class="na">ifNotOperation=</span><span class="s">&quot;download&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- Filter element having protocol WMS for user who can not dynamic --&gt;</span>
<span class="w">  </span><span class="nt">&lt;filter</span><span class="w"> </span><span class="na">xpath=</span><span class="s">&quot;*//gmd:onLine[starts-with(*/gmd:protocol/gco:CharacterString, &#39;OGC:WMS&#39;)]&quot;</span>
<span class="w">          </span><span class="na">ifNotOperation=</span><span class="s">&quot;dynamic&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/filters&gt;</span>
</pre></div>
</div>
<p>The filters are applied in XMLSerializer according to user privileges.</p>
<p>After setting up schema-ident.xml, our new GeoNetwork plugin schema for MCP contains:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">schema</span><span class="o">-</span><span class="n">ident</span><span class="o">.</span><span class="n">xml</span>
</pre></div>
</div>
</section>
<section id="creating-the-schema-conversions-xml-file">
<span id="schema-conversions"></span><h4>Creating the schema-conversions.xml file<a class="headerlink" href="#creating-the-schema-conversions-xml-file" title="Permalink to this heading">¶</a></h4>
<p>This file describes the converters that can be applied to metadata records that
belong to the schema. Each converter must be manually defined as a
GeoNetwork (Jeeves) service that can be called to transform a particular metadata
record to a different schema. The schema-conversions.xml file for the MCP is as follows:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;conversions&gt;</span>
<span class="w">   </span><span class="nt">&lt;converter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;xml_iso19139.mcp&quot;</span>
<span class="w">              </span><span class="na">nsUri=</span><span class="s">&quot;http://bluenet3.antcrc.utas.edu.au/mcp&quot;</span>
<span class="w">              </span><span class="na">schemaLocation=</span><span class="s">&quot;http://bluenet3.antcrc.utas.edu.au/mcp-1.5-experimental/schema.xsd&quot;</span>
<span class="w">              </span><span class="na">xslt=</span><span class="s">&quot;xml_iso19139.mcp.xsl&quot;</span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="nt">&lt;converter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;xml_iso19139.mcp-1.4&quot;</span>
<span class="w">              </span><span class="na">nsUri=</span><span class="s">&quot;http://bluenet3.antcrc.utas.edu.au/mcp&quot;</span>
<span class="w">              </span><span class="na">schemaLocation=</span><span class="s">&quot;http://bluenet3.antcrc.utas.edu.au/mcp/schema.xsd&quot;</span>
<span class="w">              </span><span class="na">xslt=</span><span class="s">&quot;xml_iso19139.mcp-1.4.xsl&quot;</span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="nt">&lt;converter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;xml_iso19139.mcpTooai_dc&quot;</span>
<span class="w">              </span><span class="na">nsUri=</span><span class="s">&quot;http://www.openarchives.org/OAI/2.0/&quot;</span>
<span class="w">              </span><span class="na">schemaLocation=</span><span class="s">&quot;http://www.openarchives.org/OAI/2.0/oai_dc.xsd&quot;</span>
<span class="w">              </span><span class="na">xslt=</span><span class="s">&quot;oai_dc.xsl&quot;</span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="nt">&lt;converter</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;xml_iso19139.mcpTorifcs&quot;</span>
<span class="w">              </span><span class="na">nsUri=</span><span class="s">&quot;http://ands.org.au/standards/rif-cs/registryObjects&quot;</span>
<span class="w">              </span><span class="na">schemaLocation=</span><span class="s">&quot;http://services.ands.org.au/home/orca/schemata/registryObjects.xsd&quot;</span>
<span class="w">              </span><span class="na">xslt=</span><span class="s">&quot;rif.xsl&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/conversions&gt;</span>
</pre></div>
</div>
<p>Each converter has the following attributes:</p>
<ul class="simple">
<li><p><strong>name</strong> - the name of the converter. This is the service name of the GeoNetwork
(Jeeves) service and should be unique (prefixing the service name with
xml_&lt;schema_name&gt; is a good way to make this name unique).</p></li>
<li><p><strong>nsUri</strong> - the primary namespace of the schema produced by the converter.
eg. xml_iso19139.mcpTorifcs transforms metadata records from iso19139.mcp
to the RIFCS schema. Metadata records in the RIFCS metadata schema have primary
namespace URI of <a class="reference external" href="http://ands.org.au/standards/rif-cs/registryObjects">http://ands.org.au/standards/rif-cs/registryObjects</a>.</p></li>
<li><p><strong>schemaLocation</strong> - the location (URL) of the XML schema definition (XSD)
corresponding to the nsURI.</p></li>
<li><p><strong>xslt</strong> - the name of the XSLT that actually carries out the transformation.
This XSLT should be located in the convert subdirectory of the schema plugin.</p></li>
</ul>
<p>After setting up schema-conversions.xml, our new GeoNetwork plugin schema for MCP contains:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>schema-conversions.xml<span class="w"> </span>schema-ident.xml
</pre></div>
</div>
</section>
<section id="creating-the-schema-directory-and-schema-xsd-file">
<span id="schema-and-schema-xsd"></span><h4>Creating the schema directory and schema.xsd file<a class="headerlink" href="#creating-the-schema-directory-and-schema-xsd-file" title="Permalink to this heading">¶</a></h4>
<p>The schema and schema.xsd components are used by the GeoNetwork editor
and validation functions.</p>
<p>GeoNetwork’s editor uses the XSDs to build a form that will not only order the
elements in a metadata document correctly but also offer options to create any
elements that are not in the metadata document. The idea behind this approach
is twofold. Firstly, the editor can use the XML schema definition rules to help
the user avoid creating a document that is structurally incorrect eg. missing
mandatory elements or elements not ordered correctly. Secondly, the same editor
code can be used on any XML metadata document with a defined XSD.</p>
<p>If you are defining your own metadata schema then you can create an XML schema
document using the XSD language. The elements of the language can be found
online at <a class="reference external" href="http://www.w3schools.com/schema/">http://www.w3schools.com/schema/</a> or you can refer to a textbook
such as Priscilla Walmsley’s Definitive XML Schema (Prentice Hall, 2002).
GeoNetwork’s XML schema parsing code understands almost all of the XSD language
with the exception of redefine, any and anyAttribute (although the last two
can be handled under special circumstances).</p>
<p>In the case of the Marine Community Profile, we are basically defining a number
of extensions to the base standard ISO19115/19139. These extensions are defined
using the XSD extension mechanism on the types defined in ISO19139. The
following snippet shows how the Marine Community Profile extends the
gmd:MD_Metadata element to add a new element called revisionDate:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;xs:schema</span><span class="w"> </span><span class="na">targetNamespace=</span><span class="s">&quot;http://bluenet3.antcrc.utas.edu.au/mcp&quot;</span>
<span class="w">           </span><span class="na">xmlns:mcp=</span><span class="s">&quot;http://bluenet3.antcrc.utas.edu.au/mcp&quot;</span><span class="nt">&gt;</span>

<span class="w">  </span><span class="nt">&lt;xs:element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;MD_Metadata&quot;</span><span class="w"> </span><span class="na">substitutionGroup=</span><span class="s">&quot;gmd:MD_Metadata&quot;</span>
<span class="w">                                 </span><span class="na">type=</span><span class="s">&quot;mcp:MD_Metadata_Type&quot;</span><span class="nt">/&gt;</span>

<span class="w">  </span><span class="nt">&lt;xs:complexType</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;MD_Metadata_Type&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;xs:annotation&gt;</span>
<span class="w">      </span><span class="nt">&lt;xs:documentation&gt;</span>
<span class="w">       </span>Extends<span class="w"> </span>the<span class="w"> </span>metadata<span class="w"> </span>element<span class="w"> </span>to<span class="w"> </span>include<span class="w"> </span>revisionDate
<span class="w">      </span><span class="nt">&lt;/xs:documentation&gt;</span>
<span class="w">    </span><span class="nt">&lt;/xs:annotation&gt;</span>
<span class="w">    </span><span class="nt">&lt;xs:complexContent&gt;</span>
<span class="w">      </span><span class="nt">&lt;xs:extension</span><span class="w"> </span><span class="na">base=</span><span class="s">&quot;gmd:MD_Metadata_Type&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;xs:sequence&gt;</span>
<span class="w">          </span><span class="nt">&lt;xs:element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;revisionDate&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;gco:Date_PropertyType&quot;</span>
<span class="w">                      </span><span class="na">minOccurs=</span><span class="s">&quot;0&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/xs:sequence&gt;</span>
<span class="w">        </span><span class="nt">&lt;xs:attribute</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;gco:isoType&quot;</span><span class="w"> </span><span class="na">use=</span><span class="s">&quot;required&quot;</span>
<span class="w">                      </span><span class="na">fixed=</span><span class="s">&quot;gmd:MD_Metadata&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;/xs:extension&gt;</span>
<span class="w">    </span><span class="nt">&lt;/xs:complexContent&gt;</span>
<span class="w">  </span><span class="nt">&lt;/xs:complexType&gt;</span>

<span class="nt">&lt;/xs:schema&gt;</span>
</pre></div>
</div>
<p>In short, we have defined a new element mcp:MD_Metadata with type
mcp:MD_Metadata_Type, which is an extension of gmd:MD_Metadata_Type.
By extension, we mean that the new type includes all of the elements of the old
type plus one new element, mcp:revisionDate. A mandatory attribute (gco:isoType)
is also attached to mcp:MD_Metadata with a fixed value set to the name of the element
that we extended (gmd:MD_Metadata).</p>
<p>By defining the profile in this way, it is not necessary to modify the underlying
ISO19139 schemas. So the schema directory for the MCP essentially consists of
the extensions plus the base ISO19139 schemas.
One possible directory structure is as follows:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>extensions<span class="w"> </span>gco<span class="w"> </span>gmd<span class="w"> </span>gml<span class="w"> </span>gmx<span class="w"> </span>gsr<span class="w"> </span>gss<span class="w"> </span>gts<span class="w"> </span>resources<span class="w"> </span>srv<span class="w"> </span>xlink
</pre></div>
</div>
<p>The extensions directory contains a single file mcpExtensions.xsd, which
imports the gmd namespace. The remaining directories are the ISO19139
base schemas.</p>
<p>The schema.xsd file, which is the file GeoNetwork looks for, will import the
mcpExtensions.xsd file and any other namespaces not imported as part of the
base ISO19139 schema. It is shown as follows:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;xs:schema</span><span class="w"> </span><span class="na">targetNamespace=</span><span class="s">&quot;http://bluenet3.antcrc.utas.edu.au/mcp&quot;</span>
<span class="w">           </span><span class="na">elementFormDefault=</span><span class="s">&quot;qualified&quot;</span>
<span class="w">        </span><span class="na">xmlns:xs=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema&quot;</span>
<span class="w">        </span><span class="na">xmlns:mcp=</span><span class="s">&quot;http://bluenet3.antcrc.utas.edu.au/mcp&quot;</span>
<span class="w">        </span><span class="na">xmlns:gmd=</span><span class="s">&quot;http://www.isotc211.org/2005/gmd&quot;</span>
<span class="w">        </span><span class="na">xmlns:gmx=</span><span class="s">&quot;http://www.isotc211.org/2005/gmx&quot;</span>
<span class="w">        </span><span class="na">xmlns:srv=</span><span class="s">&quot;http://www.isotc211.org/2005/srv&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;xs:include</span><span class="w"> </span><span class="na">schemaLocation=</span><span class="s">&quot;schema/extensions/mcpExtensions.xsd&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- this is a logical place to include any additional schemas that are</span>
<span class="cm">       related to ISO19139 including ISO19119 --&gt;</span>
<span class="w">  </span><span class="nt">&lt;xs:import</span><span class="w"> </span><span class="na">namespace=</span><span class="s">&quot;http://www.isotc211.org/2005/srv&quot;</span>
<span class="w">             </span><span class="na">schemaLocation=</span><span class="s">&quot;schema/srv/srv.xsd&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;xs:import</span><span class="w"> </span><span class="na">namespace=</span><span class="s">&quot;http://www.isotc211.org/2005/gmx&quot;</span>
<span class="w">             </span><span class="na">schemaLocation=</span><span class="s">&quot;schema/gmx/gmx.xsd&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/xs:schema&gt;</span>
</pre></div>
</div>
<p>At this stage, our new GeoNetwork plugin schema for MCP contains:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>schema-conversions.xml<span class="w">  </span>schema-ident.xml<span class="w">  </span>schema.xsd<span class="w">  </span>schema
</pre></div>
</div>
</section>
<section id="creating-the-extract-xslts">
<h4>Creating the extract-… XSLTs<a class="headerlink" href="#creating-the-extract-xslts" title="Permalink to this heading">¶</a></h4>
<p>GeoNetwork needs to extract certain information from a metadata record and
translate it into a common, simplified XML structure that is independent
of the metadata schema. Rather than do this with Java coded XPaths, XSLTs
are used to process the XML and return the common, simplified XML structure.</p>
<p>The three xslts we’ll create are:</p>
<ul class="simple">
<li><p><strong>extract-date-modified.xsl</strong> - this XSLT processes the metadata record and
extracts the date the metadata record was last modified. For the MCP,
this information is held in the mcp:revisionDate element which is a child
of mcp:MD_Metadata. The easiest way to create this for MCP is to copy
extract-date-modified.xsl from the iso19139 schema and modify it to suit
the MCP namespace and to use mcp:revisionDate in place of gmd:dateStamp.</p></li>
<li><p><strong>extract-gml.xsl</strong> - this XSLT processes the metadata record and extracts
the spatial extent as a gml GeometryCollection element. The gml is passed
to geotools for insertion into the spatial index (either a shapefile or a
spatial database). For ISO19115/19139 and profiles, this task is quite
easy because spatial extents (apart from the bounding box) are encoded as
gml in the metadata record. Again, the easiest way to create this for the
MCP is to copy extract-gml.xsd from the iso19139 schema ad modify it to
suit the MCP namespace.</p></li>
</ul>
<p>An example bounding box fragment from an MCP metadata record is:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;gmd:extent&gt;</span>
<span class="w">  </span><span class="nt">&lt;gmd:EX_Extent&gt;</span>
<span class="w">    </span><span class="nt">&lt;gmd:geographicElement&gt;</span>
<span class="w">      </span><span class="nt">&lt;gmd:EX_GeographicBoundingBox&gt;</span>
<span class="w">        </span><span class="nt">&lt;gmd:westBoundLongitude&gt;</span>
<span class="w">          </span><span class="nt">&lt;gco:Decimal&gt;</span>112.9<span class="nt">&lt;/gco:Decimal&gt;</span>
<span class="w">        </span><span class="nt">&lt;/gmd:westBoundLongitude&gt;</span>
<span class="w">        </span><span class="nt">&lt;gmd:eastBoundLongitude&gt;</span>
<span class="w">          </span><span class="nt">&lt;gco:Decimal&gt;</span>153.64<span class="nt">&lt;/gco:Decimal&gt;</span>
<span class="w">        </span><span class="nt">&lt;/gmd:eastBoundLongitude&gt;</span>
<span class="w">        </span><span class="nt">&lt;gmd:southBoundLatitude&gt;</span>
<span class="w">          </span><span class="nt">&lt;gco:Decimal&gt;</span>-43.8<span class="nt">&lt;/gco:Decimal&gt;</span>
<span class="w">        </span><span class="nt">&lt;/gmd:southBoundLatitude&gt;</span>
<span class="w">        </span><span class="nt">&lt;gmd:northBoundLatitude&gt;</span>
<span class="w">          </span><span class="nt">&lt;gco:Decimal&gt;</span>-9.0<span class="nt">&lt;/gco:Decimal&gt;</span>
<span class="w">        </span><span class="nt">&lt;/gmd:northBoundLatitude&gt;</span>
<span class="w">      </span><span class="nt">&lt;/gmd:EX_GeographicBoundingBox&gt;</span>
<span class="w">    </span><span class="nt">&lt;/gmd:geographicElement&gt;</span>
<span class="w">  </span><span class="nt">&lt;/gmd:EX_Extent&gt;</span>
<span class="nt">&lt;/gmd:extent&gt;</span>
</pre></div>
</div>
<p>Running extract-gml.xsl on the metadata record that contains this XML will produce:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;gml:GeometryCollection</span><span class="w"> </span><span class="na">xmlns:gml=</span><span class="s">&quot;http://www.opengis.net/gml&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;gml:Polygon&gt;</span>
<span class="w">    </span><span class="nt">&lt;gml:exterior&gt;</span>
<span class="w">      </span><span class="nt">&lt;gml:LinearRing&gt;</span>
<span class="w">        </span><span class="nt">&lt;gml:coordinates&gt;</span>
<span class="w">          </span>112.9,-9.0,<span class="w"> </span>153.64,-9.0,<span class="w"> </span>153.64,-43.8,<span class="w"> </span>112.9,-43.8,<span class="w"> </span>112.9,-9.0
<span class="w">        </span><span class="nt">&lt;/gml:coordinates&gt;</span>
<span class="w">      </span><span class="nt">&lt;/gml:LinearRing&gt;</span>
<span class="w">    </span><span class="nt">&lt;/gml:exterior&gt;</span>
<span class="w">  </span><span class="nt">&lt;/gml:Polygon&gt;</span>
<span class="nt">&lt;/gml:GeometryCollection&gt;</span>
</pre></div>
</div>
<p>If there is more than one extent in the metadata record, then they should
also appear in this gml:GeometryCollection element.</p>
<p>To find out more about gml, see Lake, Burggraf, Trninic and Rae,
“GML Geography Mark-Up Language, Foundation for the Geo-Web”, Wiley, 2004.</p>
<p>Finally, a note on projections. It is possible to have bounding polygons
in an MCP record in a projection other than EPSG:4326. GeoNetwork transforms
all projections known to GeoTools (and encoded in a form that GeoTools
understands) to EPSG:4326 when writing the spatial extents to the shapefile
or spatial database.</p>
<ul class="simple">
<li><p><strong>extract-uuid.xsl</strong> - this XSLT processes the metadata record and extracts
the identifier for the record. For the MCP and base ISO standard,
this information is held in the gmd:fileIdentifier element which is a child
of mcp:MD_Metadata.</p></li>
</ul>
<p>These xslts can be tested by running them on a metadata record from the schema.
You should use the saxon xslt processor. For example:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>java<span class="w"> </span>-jar<span class="w"> </span>INSTALL_DIR/web/geonetwork/WEB-INF/lib/saxon-9.1.0.8b-patch.jar
<span class="w">     </span>-s<span class="w"> </span>testmcp.xml<span class="w"> </span>-o<span class="w"> </span>output.xml<span class="w"> </span>extract-gml.xsl
</pre></div>
</div>
<p>At this stage, our new GeoNetwork plugin schema for MCP contains:</p>
<div class="highlight-shell notranslate"><div class="highlight"><pre><span></span>extract-date-modified.xsl<span class="w">  </span>extract-gml.xsd<span class="w">   </span>extract-uuid.xsl
schema-conversions.xml<span class="w">  </span>schema-ident.xml<span class="w">  </span>schema.xsd<span class="w">  </span>schema
</pre></div>
</div>
</section>
<section id="creating-the-localized-strings-in-the-loc-directory">
<h4>Creating the localized strings in the loc directory<a class="headerlink" href="#creating-the-localized-strings-in-the-loc-directory" title="Permalink to this heading">¶</a></h4>
<p>The loc directory contains localized strings specific to this schema, arranged
by language abbreviation in sub-directories.</p>
<p>You should provide localized strings in whatever languages you expect your
schema to be used in.</p>
<p>Localized strings for this schema can be used in the presentation xslts and
schematron error messages. For the presentation xslts:</p>
<ul class="simple">
<li><p>codelists for controlled vocabulary fields should be in
loc/&lt;language_abbreviation&gt;/codelists.xml eg. <code class="docutils literal notranslate"><span class="pre">loc/eng/codelists.xml</span></code></p></li>
<li><p>label strings that replace XML element names with more intelligible/alternative
phrases and rollover help strings should be in loc/&lt;language_abbreviation&gt;/labels.xml
eg. <code class="docutils literal notranslate"><span class="pre">loc/eng/labels.xml</span></code>.</p></li>
<li><p>all other localized strings should be in loc/&lt;language_abbreviation&gt;/strings.xml
eg. <code class="docutils literal notranslate"><span class="pre">loc/eng/strings.xml</span></code></p></li>
</ul>
<p>Note that because the MCP is a profile of ISO19115/19139 and we have followed
the GeoNetwork naming convention for profiles, we need only include the labels
and codelists that are specific to the MCP or that we want to override.
Other labels and codelists will be retrieved from the base schema iso19139.</p>
</section>
<section id="more-on-codelists-xml">
<h4>More on codelists.xml<a class="headerlink" href="#more-on-codelists-xml" title="Permalink to this heading">¶</a></h4>
<p>Typically codelists are generated from enumerated lists in the metadata
schema XSDs such as the following from
<a class="reference external" href="http://www.isotc211.org/2005/gmd/identification.xsd">http://www.isotc211.org/2005/gmd/identification.xsd</a> for gmd:MD_TopicCategoryCode
in the iso19139 schema:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;xs:element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;MD_TopicCategoryCode&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;gmd:MD_TopicCategoryCode_Type&quot;</span><span class="nt">/&gt;</span>

<span class="nt">&lt;xs:simpleType</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;MD_TopicCategoryCode_Type&quot;</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="nt">&lt;xs:restriction</span><span class="w"> </span><span class="na">base=</span><span class="s">&quot;xs:string&quot;</span><span class="nt">&gt;</span>
<span class="w">     </span><span class="nt">&lt;xs:enumeration</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;farming&quot;</span><span class="nt">/&gt;</span>
<span class="w">     </span><span class="nt">&lt;xs:enumeration</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;biota&quot;</span><span class="nt">/&gt;</span>
<span class="w">     </span><span class="nt">&lt;xs:enumeration</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;boundaries&quot;</span><span class="nt">/&gt;</span>
<span class="w">     </span><span class="nt">&lt;xs:enumeration</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;climatologyMeteorologyAtmosphere&quot;</span><span class="nt">/&gt;</span>
<span class="w">     </span><span class="nt">&lt;xs:enumeration</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;economy&quot;</span><span class="nt">/&gt;</span>
<span class="w">     </span><span class="nt">&lt;xs:enumeration</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;elevation&quot;</span><span class="nt">/&gt;</span>
<span class="w">     </span><span class="nt">&lt;xs:enumeration</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;environment&quot;</span><span class="nt">/&gt;</span>
<span class="w">     </span><span class="nt">&lt;xs:enumeration</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;geoscientificInformation&quot;</span><span class="nt">/&gt;</span>
<span class="w">     </span><span class="nt">&lt;xs:enumeration</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;health&quot;</span><span class="nt">/&gt;</span>
<span class="w">     </span><span class="nt">&lt;xs:enumeration</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;imageryBaseMapsEarthCover&quot;</span><span class="nt">/&gt;</span>
<span class="w">     </span><span class="nt">&lt;xs:enumeration</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;intelligenceMilitary&quot;</span><span class="nt">/&gt;</span>
<span class="w">     </span><span class="nt">&lt;xs:enumeration</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;inlandWaters&quot;</span><span class="nt">/&gt;</span>
<span class="w">     </span><span class="nt">&lt;xs:enumeration</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;location&quot;</span><span class="nt">/&gt;</span>
<span class="w">     </span><span class="nt">&lt;xs:enumeration</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;oceans&quot;</span><span class="nt">/&gt;</span>
<span class="w">     </span><span class="nt">&lt;xs:enumeration</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;planningCadastre&quot;</span><span class="nt">/&gt;</span>
<span class="w">     </span><span class="nt">&lt;xs:enumeration</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;society&quot;</span><span class="nt">/&gt;</span>
<span class="w">     </span><span class="nt">&lt;xs:enumeration</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;structure&quot;</span><span class="nt">/&gt;</span>
<span class="w">     </span><span class="nt">&lt;xs:enumeration</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;transportation&quot;</span><span class="nt">/&gt;</span>
<span class="w">     </span><span class="nt">&lt;xs:enumeration</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;utilitiesCommunication&quot;</span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="nt">&lt;/xs:restriction&gt;</span>
<span class="w"> </span><span class="nt">&lt;/xs:simpleType&gt;</span>
</pre></div>
</div>
<p>The following is part of the codelists.xml entry manually
created for this element:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;codelist</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;gmd:MD_TopicCategoryCode&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;entry&gt;</span>
<span class="w">    </span><span class="nt">&lt;code&gt;</span>farming<span class="nt">&lt;/code&gt;</span>
<span class="w">    </span><span class="nt">&lt;label&gt;</span>Farming<span class="nt">&lt;/label&gt;</span>
<span class="w">    </span><span class="nt">&lt;description&gt;</span>Rearing<span class="w"> </span>of<span class="w"> </span>animals<span class="w"> </span>and/or<span class="w"> </span>cultivation<span class="w"> </span>of<span class="w"> </span>plants.<span class="w"> </span>Examples:<span class="w"> </span>agriculture,
<span class="w">      </span>irrigation,<span class="w"> </span>aquaculture,<span class="w"> </span>plantations,<span class="w"> </span>herding,<span class="w"> </span>pests<span class="w"> </span>and<span class="w"> </span>diseases<span class="w"> </span>affecting<span class="w"> </span>crops<span class="w"> </span>and
<span class="w">      </span>livestock<span class="nt">&lt;/description&gt;</span>
<span class="w">  </span><span class="nt">&lt;/entry&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - --&gt;</span>
<span class="w">  </span><span class="nt">&lt;entry&gt;</span>
<span class="w">    </span><span class="nt">&lt;code&gt;</span>biota<span class="nt">&lt;/code&gt;</span>
<span class="w">    </span><span class="nt">&lt;label&gt;</span>Biota<span class="nt">&lt;/label&gt;</span>
<span class="w">    </span><span class="nt">&lt;description&gt;</span>Flora<span class="w"> </span>and/or<span class="w"> </span>fauna<span class="w"> </span>in<span class="w"> </span>natural<span class="w"> </span>environment.<span class="w"> </span>Examples:<span class="w"> </span>wildlife,<span class="w"> </span>vegetation,
<span class="w">      </span>biological<span class="w"> </span>sciences,<span class="w"> </span>ecology,<span class="w"> </span>wilderness,<span class="w"> </span>sealife,<span class="w"> </span>wetlands,<span class="w"> </span>habitat<span class="nt">&lt;/description&gt;</span>
<span class="w">  </span><span class="nt">&lt;/entry&gt;</span>
<span class="w">  </span><span class="cm">&lt;!-- - - - - - - - - - - - - - - - - - - - - - - - - --&gt;</span>
<span class="w">  </span><span class="nt">&lt;entry&gt;</span>
<span class="w">    </span><span class="nt">&lt;code&gt;</span>boundaries<span class="nt">&lt;/code&gt;</span>
<span class="w">    </span><span class="nt">&lt;label&gt;</span>Boundaries<span class="nt">&lt;/label&gt;</span>
<span class="w">    </span><span class="nt">&lt;description&gt;</span>Legal<span class="w"> </span>land<span class="w"> </span>descriptions.<span class="w"> </span>Examples:<span class="w"> </span>political<span class="w"> </span>and<span class="w"> </span>administrative
<span class="w">    </span>boundaries<span class="nt">&lt;/description&gt;</span>
<span class="w">  </span><span class="nt">&lt;/entry&gt;</span>

<span class="w">  </span>.....

<span class="nt">&lt;/codelist&gt;</span>
</pre></div>
</div>
<p>The codelists.xml file maps the enumerated values from the XSD to a localized
label and a description via the code element.</p>
<p>A localized copy of codelists.xml is made available on an XPath to the
presentation XSLTs eg. /root/gui/schemas/iso19139/codelist for the iso19139
schema.</p>
<p>The XSLT metadata.xsl which contains templates used by all metadata schema
presentation XSLTs, handles the creation of a select list/drop down menu
in the editor and display of the code and description in the metadata viewer.</p>
<p>Codelist entries can also contain a <code class="docutils literal notranslate"><span class="pre">displayIf</span></code> parameter that indicates the
context (xpath) where the codelist should be used. This allows the definition of
different codelists and dropdown menus for different elements in the editor.</p>
<p>The following example restricts the use of the codelist to service records only:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;codelist</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;gmd:MD_ScopeCode&quot;</span>
<span class="w">          </span><span class="na">displayIf=</span><span class="s">&quot;../gmd:identificationInfo/srv:SV_ServiceIdentification&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;entry&gt;</span>
<span class="w">    </span><span class="nt">&lt;code&gt;</span>service<span class="nt">&lt;/code&gt;</span>
<span class="w">    </span><span class="nt">&lt;label&gt;</span>Service<span class="nt">&lt;/label&gt;</span>
<span class="w">    </span><span class="nt">&lt;description&gt;</span>Information<span class="w"> </span>applies<span class="w"> </span>to<span class="w"> </span>a<span class="w"> </span>capability<span class="w"> </span>which<span class="w"> </span>a<span class="w"> </span>service<span class="w"> </span>provider<span class="w"> </span>entity<span class="w"> </span>makes
<span class="w">      </span>available<span class="w"> </span>to<span class="w"> </span>a<span class="w"> </span>service<span class="w"> </span>user<span class="w"> </span>entity<span class="w"> </span>through<span class="w"> </span>a<span class="w"> </span>set<span class="w"> </span>of<span class="w"> </span>interfaces<span class="w"> </span>that<span class="w"> </span>define<span class="w"> </span>a<span class="w"> </span>behaviour,
<span class="w">      </span>such<span class="w"> </span>as<span class="w"> </span>a<span class="w"> </span>use<span class="w"> </span>case
<span class="w">    </span><span class="nt">&lt;/description&gt;</span>
<span class="w">    </span><span class="nt">&lt;/entry&gt;</span>
<span class="w">  </span><span class="nt">&lt;/codelist&gt;</span>
</pre></div>
</div>
<p>The iso19139 schema has additional codelists that are managed external to
the XSDs in catalog/vocabulary files, such as
<a class="reference external" href="http://www.isotc211.org/2005/resources/Codelist/gmxCodelists.xml">http://www.isotc211.org/2005/resources/Codelist/gmxCodelists.xml</a> These have
also been added to the codelists.xml file so that they can be localized or
overridden in profiles, and include an extended description to provide more
useful information when viewing the metadata record.</p>
<p>To use the ISO19139 codelist in a profile you can add a template to point to the codelist to use:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;xsl:template</span><span class="w"> </span><span class="na">mode=</span><span class="s">&quot;mode-iso19139.xyz&quot;</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;*[*/@codeList]&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;xsl:param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;schema&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;$schema&quot;</span><span class="w"> </span><span class="na">required=</span><span class="s">&quot;no&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;xsl:param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;labels&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;$labels&quot;</span><span class="w"> </span><span class="na">required=</span><span class="s">&quot;no&quot;</span><span class="nt">/&gt;</span>

<span class="w">  </span><span class="nt">&lt;xsl:apply-templates</span><span class="w"> </span><span class="na">mode=</span><span class="s">&quot;mode-iso19139&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;.&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;xsl:with-param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;schema&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;$schema&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;xsl:with-param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;labels&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;$labels&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;xsl:with-param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;codelists&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;$codelists&quot;</span><span class="nt">/&gt;</span><span class="cm">&lt;!-- Will be the profile codelist --&gt;</span>
<span class="w">  </span><span class="nt">&lt;/xsl:apply-templates&gt;</span>
<span class="nt">&lt;/xsl:template&gt;</span>
</pre></div>
</div>
<p>To override some of the ISO19139 codelist, you can check if the codelist is defined in xyz profile and if not use the ISO19139 one:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cm">&lt;!-- check iso19139.xyz first, then fall back to iso19139 --&gt;</span>
<span class="nt">&lt;xsl:variable</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;listOfValues&quot;</span><span class="w"> </span><span class="na">as=</span><span class="s">&quot;node()&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;xsl:variable</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;profileCodeList&quot;</span><span class="w"> </span><span class="na">as=</span><span class="s">&quot;node()&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;gn-fn-metadata:getCodeListValues($schema, name(*[@codeListValue]), $codelists, .)&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;xsl:choose&gt;</span>
<span class="w">    </span><span class="nt">&lt;xsl:when</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;count($profileCodeList/*) = 0&quot;</span><span class="nt">&gt;</span><span class="w"> </span><span class="cm">&lt;!-- do iso19139 --&gt;</span>
<span class="w">      </span><span class="nt">&lt;xsl:copy-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;gn-fn-metadata:getCodeListValues(&#39;iso19139&#39;, name(*[@codeListValue]), $iso19139codelists, .)&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/xsl:when&gt;</span>
<span class="w">    </span><span class="nt">&lt;xsl:otherwise&gt;</span>
<span class="w">      </span><span class="nt">&lt;xsl:copy-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;$profileCodeList&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/xsl:otherwise&gt;</span>
<span class="w">  </span><span class="nt">&lt;/xsl:choose&gt;</span>
<span class="nt">&lt;/xsl:variable&gt;</span>
</pre></div>
</div>
<p>The iso19139 schema has additional templates in its presentation xslts to
handle codelists because they are specific to that schema. These are
discussed in the section on presentation XSLTs later in this manual.</p>
</section>
<section id="more-on-labels-xml">
<h4>More on labels.xml<a class="headerlink" href="#more-on-labels-xml" title="Permalink to this heading">¶</a></h4>
<p>A localized copy of <code class="docutils literal notranslate"><span class="pre">labels.xml</span></code> is made available on an XPath to the presentation
XSLTs eg. /root/gui/schemas/iso19139/labels for the iso19139 schema.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">labels.xml</span></code> file can also be used to provide helper values in the form of
a drop down/select list for free text fields. As an example:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;gmd:credit&quot;</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;27.0&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;label&gt;</span>Credit<span class="nt">&lt;/label&gt;</span>
<span class="w">  </span><span class="nt">&lt;description&gt;</span>Recognition<span class="w"> </span>of<span class="w"> </span>those<span class="w"> </span>who<span class="w"> </span>contributed<span class="w"> </span>to<span class="w"> </span>the<span class="w"> </span>resource(s)<span class="nt">&lt;/description&gt;</span>
<span class="w">  </span><span class="nt">&lt;helper&gt;</span>
<span class="w">    </span><span class="nt">&lt;option</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;University of Tasmania&quot;</span><span class="nt">&gt;</span>UTAS<span class="nt">&lt;/option&gt;</span>
<span class="w">    </span><span class="nt">&lt;option</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;University of Queensland&quot;</span><span class="nt">&gt;</span>UQ<span class="nt">&lt;/option&gt;</span>
<span class="w">  </span><span class="nt">&lt;/helper&gt;</span>
<span class="nt">&lt;/element&gt;</span>
</pre></div>
</div>
<p>This would result in the Editor (through the XSLT metadata.xsl) displaying the
credit field with these helper options listed beside it in a drop down/select
menu something like the following:</p>
<figure class="align-default">
<img alt="../_images/editor-helper.png" src="../_images/editor-helper.png" />
</figure>
</section>
<section id="more-on-strings-xml">
<h4>More on strings.xml<a class="headerlink" href="#more-on-strings-xml" title="Permalink to this heading">¶</a></h4>
<p>A localized copy of <code class="docutils literal notranslate"><span class="pre">strings.xml</span></code> is made available on an XPath to the
presentation XSLTs eg. /root/gui/schemas/iso19139/strings for the iso19139 schema.</p>
<p>After adding the localized strings, our new GeoNetwork plugin schema for MCP contains:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">extract</span><span class="o">-</span><span class="n">date</span><span class="o">-</span><span class="n">modified</span><span class="o">.</span><span class="n">xsl</span>  <span class="n">extract</span><span class="o">-</span><span class="n">gml</span><span class="o">.</span><span class="n">xsd</span>  <span class="n">extract</span><span class="o">-</span><span class="n">uuid</span><span class="o">.</span><span class="n">xsl</span>
<span class="n">loc</span>  <span class="n">present</span>  <span class="n">schema</span><span class="o">-</span><span class="n">conversions</span><span class="o">.</span><span class="n">xml</span>  <span class="n">schema</span><span class="o">-</span><span class="n">ident</span><span class="o">.</span><span class="n">xml</span>  <span class="n">schema</span><span class="o">.</span><span class="n">xsd</span>
<span class="n">schema</span>
</pre></div>
</div>
</section>
<section id="creating-the-presentations-using-formatter">
<h4>Creating the presentations using formatter<a class="headerlink" href="#creating-the-presentations-using-formatter" title="Permalink to this heading">¶</a></h4>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.0.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>See <a class="reference internal" href="../tutorials/customui/view/formatter.html#tuto-formatter"><span class="std std-ref">Create a new formatter</span></a></p>
</div>
</section>
<section id="customizing-the-editor">
<h4>Customizing the editor<a class="headerlink" href="#customizing-the-editor" title="Permalink to this heading">¶</a></h4>
<div class="versionadded">
<p><span class="versionmodified added">New in version 3.0.</span></p>
</div>
<div class="admonition seealso">
<p class="admonition-title">See also</p>
<p>See <a class="reference internal" href="editor-ui/creating-custom-editor.html#creating-custom-editor"><span class="std std-ref">Customizing editor</span></a></p>
</div>
</section>
<section id="creating-the-presentations-xslts-in-the-present-directory">
<h4>Creating the presentations XSLTs in the present directory<a class="headerlink" href="#creating-the-presentations-xslts-in-the-present-directory" title="Permalink to this heading">¶</a></h4>
<div class="deprecated">
<p><span class="versionmodified deprecated">Deprecated since version 3.0.0.</span></p>
</div>
<p>Each metadata schema should contain XSLTs that display and possibly edit metadata
records that belong to the schema. These XSLTs are held in the <code class="docutils literal notranslate"><span class="pre">present</span></code> directory.</p>
<p>To be used in the XSLT include/import hierarchy these XSLTs must follow a
naming convention: metadata-&lt;schema-name&gt;.xsl. So for example, the presentation
xslt for the iso19139 schema is <code class="docutils literal notranslate"><span class="pre">metadata-iso19139.xsl</span></code>. For the MCP, since
our schema name is iso19139.mcp, the presentation XSLT would be called
<code class="docutils literal notranslate"><span class="pre">metadata-iso19193.mcp.xsl</span></code>.</p>
<p>Any XSLTs included by the presentation XSLT should also be in the present
directory (this is a convention for clarity - it is not mandatory as
include/import URLs can be mapped in the oasis-catalog.xml for the schema
to other locations).</p>
<p>There are certain XSLT templates that the presentation XSLT must have:</p>
<ul class="simple">
<li><p>the <strong>main</strong> template, which must be called: metadata-&lt;schema-name&gt;. For the
MCP profile of iso19139 the main template would look like the following (taken
from metadata-iso19139.mcp.xsl):</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">&lt;</span><span class="n">xsl</span><span class="p">:</span><span class="n">template</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;metadata-iso19139.mcp&quot;</span><span class="o">&gt;</span>
  <span class="o">&lt;</span><span class="n">xsl</span><span class="p">:</span><span class="n">param</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;schema&quot;</span><span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="n">xsl</span><span class="p">:</span><span class="n">param</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;edit&quot;</span> <span class="n">select</span><span class="o">=</span><span class="s2">&quot;false()&quot;</span><span class="o">/&gt;</span>
  <span class="o">&lt;</span><span class="n">xsl</span><span class="p">:</span><span class="n">param</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;embedded&quot;</span><span class="o">/&gt;</span>

  <span class="o">&lt;</span><span class="n">xsl</span><span class="p">:</span><span class="n">apply</span><span class="o">-</span><span class="n">templates</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;iso19139&quot;</span> <span class="n">select</span><span class="o">=</span><span class="s2">&quot;.&quot;</span> <span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="n">xsl</span><span class="p">:</span><span class="k">with</span><span class="o">-</span><span class="n">param</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;schema&quot;</span> <span class="n">select</span><span class="o">=</span><span class="s2">&quot;$schema&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">xsl</span><span class="p">:</span><span class="k">with</span><span class="o">-</span><span class="n">param</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;edit&quot;</span>   <span class="n">select</span><span class="o">=</span><span class="s2">&quot;$edit&quot;</span><span class="o">/&gt;</span>
    <span class="o">&lt;</span><span class="n">xsl</span><span class="p">:</span><span class="k">with</span><span class="o">-</span><span class="n">param</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;embedded&quot;</span> <span class="n">select</span><span class="o">=</span><span class="s2">&quot;$embedded&quot;</span> <span class="o">/&gt;</span>
  <span class="o">&lt;/</span><span class="n">xsl</span><span class="p">:</span><span class="n">apply</span><span class="o">-</span><span class="n">templates</span><span class="o">&gt;</span>
<span class="o">&lt;/</span><span class="n">xsl</span><span class="p">:</span><span class="n">template</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>Analyzing this template:</p>
<ol class="arabic simple">
<li><p>The name=”metadata-iso19139.mcp” is used by the main element processing
template in metadata.xsl: elementEP. The main metadata services, show and edit,
end up calling metadata-show.xsl and metadata-edit.xsl respectively with the
metadata record passed from the Java service. Both these XSLTs, process the metadata record by applying the elementEP template from metadata.xsl to the root element. The elementEP template calls this main schema template using the schema name iso19139.mcp.</p></li>
<li><p>The job of this main template is set to process all the elements of the
metadata record using templates declared with a mode name that matches
the schema name or the name of the base schema (in this case iso19139).
This modal processing is to ensure that only templates intended to process
metadata elements from this schema or the base schema are applied. The reason
for this is that almost all profiles change or add a small number of elements
to those in the base schema. So most of the metadata elements in a profile
can be processed in the mode of the base schema. We’ll see later in this
section how to override processing of an element in the base schema.</p></li>
</ol>
<ul class="simple">
<li><p>a <strong>completeTab</strong> template, which must be called: &lt;schema-name&gt;CompleteTab.
This template will display all tabs, apart from the ‘default’ (or simple mode)
and the ‘XML View’ tabs, in the left hand frame of the editor/viewer screen.
Here is an example for the MCP:</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;xsl:template</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;iso19139.mcpCompleteTab&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;xsl:param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tabLink&quot;</span><span class="nt">/&gt;</span>

<span class="w">  </span><span class="nt">&lt;xsl:call-template</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;displayTab&quot;</span><span class="nt">&gt;</span><span class="w"> </span><span class="cm">&lt;!-- non existent tab - by profile --&gt;</span>
<span class="w">    </span><span class="nt">&lt;xsl:with-param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tab&quot;</span><span class="w">     </span><span class="na">select=</span><span class="s">&quot;&#39;&#39;&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;xsl:with-param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;text&quot;</span><span class="w">    </span><span class="na">select=</span><span class="s">&quot;/root/gui/strings/byGroup&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;xsl:with-param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tabLink&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;&#39;&#39;&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/xsl:call-template&gt;</span>

<span class="w">  </span><span class="nt">&lt;xsl:call-template</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;displayTab&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;xsl:with-param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tab&quot;</span><span class="w">     </span><span class="na">select=</span><span class="s">&quot;&#39;mcpMinimum&#39;&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;xsl:with-param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;text&quot;</span><span class="w">    </span><span class="na">select=</span><span class="s">&quot;/root/gui/strings/iso19139.mcp/mcpMinimum&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;xsl:with-param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;indent&quot;</span><span class="w">  </span><span class="na">select=</span><span class="s">&quot;&#39;&amp;#xA0;&amp;#xA0;&amp;#xA0;&#39;&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;xsl:with-param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tabLink&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;$tabLink&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/xsl:call-template&gt;</span>

<span class="w">  </span><span class="nt">&lt;xsl:call-template</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;displayTab&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;xsl:with-param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tab&quot;</span><span class="w">     </span><span class="na">select=</span><span class="s">&quot;&#39;mcpCore&#39;&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;xsl:with-param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;text&quot;</span><span class="w">    </span><span class="na">select=</span><span class="s">&quot;/root/gui/strings/iso19139.mcp/mcpCore&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;xsl:with-param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;indent&quot;</span><span class="w">  </span><span class="na">select=</span><span class="s">&quot;&#39;&amp;#xA0;&amp;#xA0;&amp;#xA0;&#39;&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;xsl:with-param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tabLink&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;$tabLink&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/xsl:call-template&gt;</span>

<span class="w">  </span><span class="nt">&lt;xsl:call-template</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;displayTab&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;xsl:with-param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tab&quot;</span><span class="w">     </span><span class="na">select=</span><span class="s">&quot;&#39;complete&#39;&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;xsl:with-param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;text&quot;</span><span class="w">    </span><span class="na">select=</span><span class="s">&quot;/root/gui/strings/iso19139.mcp/mcpAll&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;xsl:with-param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;indent&quot;</span><span class="w">  </span><span class="na">select=</span><span class="s">&quot;&#39;&amp;#xA0;&amp;#xA0;&amp;#xA0;&#39;&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;xsl:with-param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;tabLink&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;$tabLink&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/xsl:call-template&gt;</span>

<span class="w">  </span>......<span class="w"> </span>(same<span class="w"> </span>as<span class="w"> </span>for<span class="w"> </span>iso19139CompleteTab<span class="w"> </span>in
<span class="w"> </span>GEONETWORK_DATA_DIR/schema_plugins/iso19139/present/
<span class="w"> </span>metadata-iso19139.xsl)<span class="w"> </span>......

<span class="nt">&lt;/xsl:template&gt;</span>
</pre></div>
</div>
<p>This template is called by the template named “tab” (which also adds the “default”
and “XML View” tabs) in <code class="docutils literal notranslate"><span class="pre">INSTALL_DIR/web/geonetwork/xsl/metadata-tab-utils.xsl</span></code>
using the schema name. That XSLT also has the code for the “displayTab” template.</p>
<p>‘mcpMinimum’, ‘mcpCore’, ‘complete’ etc are the names of the tabs. The name of
the current or active tab is stored in the global variable “currTab” available
to all presentation XSLTs. Logic to decide what to display when a particular
tab is active should be contained in the root element processing tab.</p>
<ul class="simple">
<li><p>a <strong>root element</strong> processing tab. This tab should match on the root element
of the metadata record. For example, for the iso19139 schema:</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;xsl:template</span><span class="w"> </span><span class="na">mode=</span><span class="s">&quot;iso19139&quot;</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;gmd:MD_Metadata&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;xsl:param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;schema&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;xsl:param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;edit&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;xsl:param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;embedded&quot;</span><span class="nt">/&gt;</span>

<span class="w">  </span><span class="nt">&lt;xsl:choose&gt;</span>

<span class="w">  </span><span class="cm">&lt;!-- metadata tab --&gt;</span>
<span class="w">  </span><span class="nt">&lt;xsl:when</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;$currTab=&#39;metadata&#39;&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;xsl:call-template</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;iso19139Metadata&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;xsl:with-param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;schema&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;$schema&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;xsl:with-param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;edit&quot;</span><span class="w">   </span><span class="na">select=</span><span class="s">&quot;$edit&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/xsl:call-template&gt;</span>
<span class="w">  </span><span class="nt">&lt;/xsl:when&gt;</span>

<span class="w">  </span><span class="cm">&lt;!-- identification tab --&gt;</span>
<span class="w">  </span><span class="nt">&lt;xsl:when</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;$currTab=&#39;identification&#39;&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;xsl:apply-templates</span><span class="w"> </span><span class="na">mode=</span><span class="s">&quot;elementEP&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;gmd:identificationInfo|geonet:child[string(@name)=&#39;identificationInfo&#39;]&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;xsl:with-param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;schema&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;$schema&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;xsl:with-param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;edit&quot;</span><span class="w">   </span><span class="na">select=</span><span class="s">&quot;$edit&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/xsl:apply-templates&gt;</span>
<span class="w">  </span><span class="nt">&lt;/xsl:when&gt;</span>

<span class="w">  </span>.........

<span class="nt">&lt;/xsl:template&gt;</span>
</pre></div>
</div>
<p>This template is basically a very long “choose” statement with “when” clauses
that test the value of the currently defined tab (in global variable currTab).
Each “when” clause will display the set of metadata elements that correspond
to the tab definition using “elementEP” directly (as in the “when” clause
for the ‘identification’ tab above) or via a named template (as in the
‘metadata’ tab above). For the MCP our template is similar to the one above
for iso19139, except that the match would be on “mcp:MD_Metadata” (and the
processing mode may differ - see the section
‘An alternative XSLT design for profiles’ below for more details).</p>
<ul class="simple">
<li><p>a <strong>brief</strong> template, which must be called: &lt;schema-name&gt;Brief. This template
processes the metadata record and extracts from it a format neutral summary
of the metadata for purposes such as displaying the search results.
Here is an example for the eml-gbif schema (because it is fairly short!):</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;xsl:template</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;eml-gbifBrief&quot;</span><span class="nt">&gt;</span>
<span class="w"> </span><span class="nt">&lt;xsl:for-each</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;/metadata/*[1]&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;metadata&gt;</span>
<span class="w">    </span><span class="nt">&lt;title&gt;&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;normalize-space(dataset/title[1])&quot;</span><span class="nt">/&gt;&lt;/title&gt;</span>
<span class="w">    </span><span class="nt">&lt;abstract&gt;&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;dataset/abstract&quot;</span><span class="nt">/&gt;&lt;/abstract&gt;</span>

<span class="w">    </span><span class="nt">&lt;xsl:for-each</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;dataset/keywordSet/keyword&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;xsl:copy-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;.&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/xsl:for-each&gt;</span>

<span class="w">    </span><span class="nt">&lt;geoBox&gt;</span>
<span class="w">        </span><span class="nt">&lt;westBL&gt;&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;dataset/coverage/geographicCoverage/boundingCoordinates/westBoundingCoordinate&quot;</span><span class="nt">/&gt;&lt;/westBL&gt;</span>
<span class="w">        </span><span class="nt">&lt;eastBL&gt;&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;dataset/coverage/geographicCoverage/boundingCoordinates/eastBoundingCoordinate&quot;</span><span class="nt">/&gt;&lt;/eastBL&gt;</span>
<span class="w">        </span><span class="nt">&lt;southBL&gt;&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;dataset/coverage/geographicCoverage/boundingCoordinates/southBoundingCoordinate&quot;</span><span class="nt">/&gt;&lt;/southBL&gt;</span>
<span class="w">        </span><span class="nt">&lt;northBL&gt;&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;dataset/coverage/geographicCoverage/boundingCoordinates/northBoundingCoordinate&quot;</span><span class="nt">/&gt;&lt;/northBL&gt;</span>
<span class="w">    </span><span class="nt">&lt;/geoBox&gt;</span>
<span class="w">    </span><span class="nt">&lt;xsl:copy-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;geonet:info&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;/metadata&gt;</span>
<span class="w"> </span><span class="nt">&lt;/xsl:for-each&gt;</span>
<span class="nt">&lt;/xsl:template&gt;</span>
</pre></div>
</div>
<p>Analyzing this template:</p>
<ol class="arabic simple">
<li><p>The template matches on an element eml-gbifBrief, created by the mode=”brief”
template in metadata-utils.xsl. The metadata record will be the first child
in the /metadata XPath.</p></li>
<li><p>Then process metadata elements to produce a flat XML structure that is
used by search-results-xhtml.xsl to display a summary of the metadata record
found by a search.</p></li>
</ol>
<p>Once again, for profiles of an existing schema, it makes sense to use a
slightly different approach so that the profile need not duplicate templates.
Here is an example from metadata-iso19139.mcp.xsl:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;xsl:template</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;iso19139.mcpBrief&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;metadata&gt;</span>
<span class="w">    </span><span class="nt">&lt;xsl:for-each</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;/metadata/*[1]&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="cm">&lt;!-- call iso19139 brief --&gt;</span>
<span class="w">      </span><span class="nt">&lt;xsl:call-template</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;iso19139-brief&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="cm">&lt;!-- now brief elements for mcp specific elements --&gt;</span>
<span class="w">      </span><span class="nt">&lt;xsl:call-template</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;iso19139.mcp-brief&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/xsl:for-each&gt;</span>
<span class="w">  </span><span class="nt">&lt;/metadata&gt;</span>
<span class="nt">&lt;/xsl:template&gt;</span>
</pre></div>
</div>
<p>This template splits the processing between the base iso19139 schema
and a brief template that handles elements specific to the profile.
This assumes that:</p>
<ol class="arabic simple">
<li><p>The base schema has separated the &lt;metadata&gt; element from the remainder of
its brief processing so that it can be called by profiles</p></li>
<li><p>The profile includes links to equivalent elements that can be used by the
base schema to process common elements eg. for ISO19139, elements in the
profile have gco:isoType attributes that give the name of the base element
and can be used in XPath matches such as
“gmd:MD_DataIdentification|*[&#64;gco:isoType=’gmd:MD_DataIdentification’]”.</p></li>
</ol>
<ul class="simple">
<li><p>templates that match on elements specific to the schema. Here is an
example from the eml-gbif schema:</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cm">&lt;!-- keywords are processed to add thesaurus name in brackets afterwards</span>
<span class="cm">     in view mode --&gt;</span>

<span class="nt">&lt;xsl:template</span><span class="w"> </span><span class="na">mode=</span><span class="s">&quot;eml-gbif&quot;</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;keywordSet&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;xsl:param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;schema&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;xsl:param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;edit&quot;</span><span class="nt">/&gt;</span>

<span class="w">  </span><span class="nt">&lt;xsl:choose&gt;</span>
<span class="w">    </span><span class="nt">&lt;xsl:when</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;$edit=false()&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;xsl:variable</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;keyword&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;xsl:for-each</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;keyword&quot;</span><span class="nt">&gt;</span>
<span class="w">          </span><span class="nt">&lt;xsl:if</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;position() &amp;gt; 1&quot;</span><span class="nt">&gt;</span>,<span class="w">  </span><span class="nt">&lt;/xsl:if&gt;</span>
<span class="w">          </span><span class="nt">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;.&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/xsl:for-each&gt;</span>
<span class="w">        </span><span class="nt">&lt;xsl:if</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;keywordThesaurus&quot;</span><span class="nt">&gt;</span>
<span class="w">          </span><span class="nt">&lt;xsl:text&gt;</span><span class="w"> </span>(<span class="nt">&lt;/xsl:text&gt;</span>
<span class="w">          </span><span class="nt">&lt;xsl:value-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;keywordThesaurus&quot;</span><span class="nt">/&gt;</span>
<span class="w">          </span><span class="nt">&lt;xsl:text&gt;</span>)<span class="nt">&lt;/xsl:text&gt;</span>
<span class="w">        </span><span class="nt">&lt;/xsl:if&gt;</span>
<span class="w">      </span><span class="nt">&lt;/xsl:variable&gt;</span>
<span class="w">      </span><span class="nt">&lt;xsl:apply-templates</span><span class="w"> </span><span class="na">mode=</span><span class="s">&quot;simpleElement&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;.&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;xsl:with-param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;schema&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;$schema&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;xsl:with-param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;edit&quot;</span><span class="w">   </span><span class="na">select=</span><span class="s">&quot;$edit&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;xsl:with-param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;text&quot;</span><span class="w">    </span><span class="na">select=</span><span class="s">&quot;$keyword&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;/xsl:apply-templates&gt;</span>
<span class="w">    </span><span class="nt">&lt;/xsl:when&gt;</span>
<span class="w">    </span><span class="nt">&lt;xsl:otherwise&gt;</span>
<span class="w">      </span><span class="nt">&lt;xsl:apply-templates</span><span class="w"> </span><span class="na">mode=</span><span class="s">&quot;complexElement&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;.&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;xsl:with-param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;schema&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;$schema&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;xsl:with-param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;edit&quot;</span><span class="w">   </span><span class="na">select=</span><span class="s">&quot;$edit&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;/xsl:apply-templates&gt;</span>
<span class="w">    </span><span class="nt">&lt;/xsl:otherwise&gt;</span>
<span class="w">  </span><span class="nt">&lt;/xsl:choose&gt;</span>
<span class="nt">&lt;/xsl:template&gt;</span>
</pre></div>
</div>
<p>Analyzing this template:</p>
<ol class="arabic simple">
<li><p>In view mode the individual keywords from the set are concatenated
into a comma separated string with the name of the thesaurus in brackets
at the end.</p></li>
<li><p>In edit mode, the keywordSet is handled as a complex element ie. the user
can add individual keyword elements with content and a single thesaurus name.</p></li>
<li><p>This is an example of the type of processing that can be done on an
element in a metadata record.</p></li>
</ol>
<p>For profiles, templates for elements can be defined in the same way except
that the template will process in the mode of the base schema. Here is an
example showing the first few lines of a template for processing
the mcp:revisionDate element:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;xsl:template</span><span class="w"> </span><span class="na">mode=</span><span class="s">&quot;iso19139&quot;</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;mcp:revisionDate&quot;</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="nt">&lt;xsl:param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;schema&quot;</span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="nt">&lt;xsl:param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;edit&quot;</span><span class="nt">/&gt;</span>

<span class="w">   </span><span class="nt">&lt;xsl:choose&gt;</span>
<span class="w">     </span><span class="nt">&lt;xsl:when</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;$edit=true()&quot;</span><span class="nt">&gt;</span>
<span class="w">       </span><span class="nt">&lt;xsl:apply-templates</span><span class="w"> </span><span class="na">mode=</span><span class="s">&quot;simpleElement&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;.&quot;</span><span class="nt">&gt;</span>
<span class="w">         </span><span class="nt">&lt;xsl:with-param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;schema&quot;</span><span class="w">  </span><span class="na">select=</span><span class="s">&quot;$schema&quot;</span><span class="nt">/&gt;</span>
<span class="w">         </span><span class="nt">&lt;xsl:with-param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;edit&quot;</span><span class="w">   </span><span class="na">select=</span><span class="s">&quot;$edit&quot;</span><span class="nt">/&gt;</span>

<span class="w">   </span>......
</pre></div>
</div>
<p>If a template for a profile is intended to override a template in the
base schema, then the template can be defined in the presentation XSLT
for the profile with a priority attribute set to a high number and an XPath
condition that ensures the template is processed for the profile only.
For example in the MCP, we can override the handling of
gmd:EX_GeographicBoundingBox in metadata-iso19139.xsl by defining a
template in metadata-iso19139.mcp.xsl as follows:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;xsl:template</span><span class="w"> </span><span class="na">mode=</span><span class="s">&quot;iso19139&quot;</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;gmd:EX_GeographicBoundingBox[starts-with(//geonet:info/schema,&#39;iso19139.mcp&#39;)]&quot;</span><span class="w"> </span><span class="na">priority=</span><span class="s">&quot;3&quot;</span><span class="nt">&gt;</span>

......
</pre></div>
</div>
<p>Finally, a profile may also extend some of the existing codelists in the
base schema. These extended codelists should be held in a localized codelists.xml.
As an example, in iso19139 these codelists are often attached to elements like the following:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;gmd:role&gt;</span>
<span class="w">  </span><span class="nt">&lt;gmd:CI_RoleCode</span><span class="w"> </span><span class="na">codeList=</span><span class="s">&quot;http://www.isotc211.org/2005/resources/Codelist/gmxCodelists.xml#CI_RoleCode&quot;</span><span class="w"> </span><span class="na">codeListValue=</span><span class="s">&quot;custodian&quot;</span><span class="nt">&gt;</span>custodian<span class="nt">&lt;/gmd:CI_RoleCode&gt;</span>
<span class="nt">&lt;/gmd:role&gt;</span>
</pre></div>
</div>
<p>Templates for handling these elements are in the iso19139 presentation
XSLT <code class="docutils literal notranslate"><span class="pre">GEONETWORK_DATA_DIR/schema_plugins/iso19139/present/metadata-iso19139.xsl</span></code>.
These templates use the name of the element (eg. gmd:CI_RoleCode) and the
codelist XPath (eg. /root/gui/schemas/iso19139/codelists) to build select
list/drop down menus when editing and to display a full description when viewing.
See templates near the template named ‘iso19139Codelist’. These templates can
handle the extended codelists for any profile because they:</p>
<ul class="simple">
<li><p>match on any element that has a child element with attribute codeList</p></li>
<li><p>use the schema name in the codelists XPath</p></li>
<li><p>fall back to the base iso19139 schema if the profile codelist doesn’t have
the required codelist</p></li>
</ul>
<p>However, if you don’t need localized codelists, it is often easier and more
direct to extract codelists directly from the <code class="docutils literal notranslate"><span class="pre">gmxCodelists.xml</span></code> file.
This is in fact the solution that has been adopted for the MCP.
The <code class="docutils literal notranslate"><span class="pre">gmxCodelists.xml</span></code> file is included in the presentation xslt for
the MCP using a statement like:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;xsl:variable</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;codelistsmcp&quot;</span>
<span class="w">              </span><span class="na">select=</span><span class="s">&quot;document(&#39;../schema/resources/Codelist/gmxCodelists.xml&#39;)&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>Check the codelist handling templates in <code class="docutils literal notranslate"><span class="pre">metadata-iso19139.mcp.xsl</span></code> to see how this works.</p>
</section>
<section id="an-alternative-xslt-design-for-profiles">
<h4>An alternative XSLT design for profiles<a class="headerlink" href="#an-alternative-xslt-design-for-profiles" title="Permalink to this heading">¶</a></h4>
<p>In all powerful languages there will be more than one way to achieve
a particular goal. This alternative XSLT design is for processing profiles.
The idea behind the alternative is based on the following observations about
the GeoNetwork XSLTs:</p>
<ol class="arabic simple">
<li><p>All elements are initially processed by apply-templates in mode “elementEP”.</p></li>
<li><p>The template “elementEP” (see <code class="docutils literal notranslate"><span class="pre">INSTALL_DIR/web/geonetwork/xsl/metadata.xsl</span></code>)
eventually calls the <strong>main</strong> template of the schema/profile.</p></li>
<li><p>The main template can initially process the element in a mode particular
to the profile and if this is not successful (ie. no template matches
and thus no HTML elements are returned), process the element in the mode
of the base schema.</p></li>
</ol>
<p>The advantage of this design is that overriding a template for an element in
the base schema does not need the priority attribute or an XPath condition
check on the schema name.</p>
<p>Here is an example for the MCP (iso19139.mcp) with base schema iso19139:</p>
<ul class="simple">
<li><p>the <strong>main</strong> template, which must be called: metadata-iso19139.mcp.xsl:</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cm">&lt;!-- main template - the way into processing iso19139.mcp --&gt;</span>
<span class="nt">&lt;xsl:template</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;metadata-iso19139.mcp&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;xsl:param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;schema&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;xsl:param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;edit&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;false()&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;xsl:param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;embedded&quot;</span><span class="nt">/&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- process in profile mode first --&gt;</span>
<span class="w">    </span><span class="nt">&lt;xsl:variable</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;mcpElements&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;xsl:apply-templates</span><span class="w"> </span><span class="na">mode=</span><span class="s">&quot;iso19139.mcp&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;.&quot;</span><span class="w"> </span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;xsl:with-param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;schema&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;$schema&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;xsl:with-param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;edit&quot;</span><span class="w">   </span><span class="na">select=</span><span class="s">&quot;$edit&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;xsl:with-param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;embedded&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;$embedded&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;/xsl:apply-templates&gt;</span>
<span class="w">    </span><span class="nt">&lt;/xsl:variable&gt;</span>

<span class="w">    </span><span class="nt">&lt;xsl:choose&gt;</span>

<span class="w">      </span><span class="cm">&lt;!-- if we got a match in profile mode then show it --&gt;</span>
<span class="w">      </span><span class="nt">&lt;xsl:when</span><span class="w"> </span><span class="na">test=</span><span class="s">&quot;count($mcpElements/*)&gt;0&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;xsl:copy-of</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;$mcpElements&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;/xsl:when&gt;</span>

<span class="w">      </span><span class="cm">&lt;!-- otherwise process in base iso19139 mode --&gt;</span>
<span class="w">      </span><span class="nt">&lt;xsl:otherwise&gt;</span>
<span class="w">        </span><span class="nt">&lt;xsl:apply-templates</span><span class="w"> </span><span class="na">mode=</span><span class="s">&quot;iso19139&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;.&quot;</span><span class="w"> </span><span class="nt">&gt;</span>
<span class="w">          </span><span class="nt">&lt;xsl:with-param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;schema&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;$schema&quot;</span><span class="nt">/&gt;</span>
<span class="w">          </span><span class="nt">&lt;xsl:with-param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;edit&quot;</span><span class="w">   </span><span class="na">select=</span><span class="s">&quot;$edit&quot;</span><span class="nt">/&gt;</span>
<span class="w">          </span><span class="nt">&lt;xsl:with-param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;embedded&quot;</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;$embedded&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;/xsl:apply-templates&gt;</span>
<span class="w">      </span><span class="nt">&lt;/xsl:otherwise&gt;</span>
<span class="w">    </span><span class="nt">&lt;/xsl:choose&gt;</span>
<span class="nt">&lt;/xsl:template&gt;</span>
</pre></div>
</div>
<p>Analyzing this template:</p>
<ol class="arabic simple">
<li><p>The name=”metadata-iso19139.mcp” is used by the main element processing
template in metadata.xsl: elementEP. The main metadata services,
show and edit, end up calling metadata-show.xsl and metadata-edit.xsl
respectively with the metadata record passed from the Java service.
Both these XSLTs, process the metadata record by applying the elementEP
template from metadata.xsl to the root element. elementEP calls the
appropriate main schema template using the schema name.</p></li>
<li><p>The job of this main template is set to process all the elements of the
metadata profile. The processing takes place in one of two modes.
Firstly, the element is processed in the profile mode (iso19139.mcp).
If a match is found then HTML elements will be returned and copied to the
output document. If no HTML elements are returned then the element is
processed in the base schema mode, iso19139.</p></li>
</ol>
<ul class="simple">
<li><p>templates that match on elements specific to the profile have mode iso19139.mcp:</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;xsl:template</span><span class="w"> </span><span class="na">mode=</span><span class="s">&quot;iso19139.mcp&quot;</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;mcp:taxonomicElement&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;xsl:param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;schema&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;xsl:param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;edit&quot;</span><span class="nt">/&gt;</span>

<span class="w">  </span>.....
<span class="nt">&lt;/xsl:template&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p>templates that override elements in the base schema are processed in the
profile mode iso19139.mcp</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;xsl:template</span><span class="w"> </span><span class="na">mode=</span><span class="s">&quot;iso19139.mcp&quot;</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;gmd:keyword&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;xsl:param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;schema&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;xsl:param</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;edit&quot;</span><span class="nt">/&gt;</span>

<span class="w">  </span>.....
<span class="nt">&lt;/xsl:template&gt;</span>
</pre></div>
</div>
<p>Notice that the template header of the profile has a simpler design than
that used for the original design? Neither the priority attribute or the
schema XPath condition is required because we are using a different mode
to the base schema.</p>
<ul class="simple">
<li><p>To support processing in two modes we need to add a null template to the profile
mode iso19139.mcp as follows:</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;xsl:template</span><span class="w"> </span><span class="na">mode=</span><span class="s">&quot;iso19139.mcp&quot;</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;*|@*&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>This template will match all elements that we don’t have a specific template
for in the profile mode iso19139.mcp. These elements will be processed in the
base schema mode iso19139 instead because the null template returns nothing
(see the main template discussion above).</p>
<p>The remainder of the discussion in the original design relating to tabs etc
applies to the alternative design and is not repeated here.</p>
</section>
<section id="csw-presentation-xslts">
<h4>CSW Presentation XSLTs<a class="headerlink" href="#csw-presentation-xslts" title="Permalink to this heading">¶</a></h4>
<p>The CSW server can be asked to provide records in a number of output schemas.
The two supported by GeoNetwork are:</p>
<ul class="simple">
<li><p><strong>ogc</strong> - <a class="reference external" href="http://www.opengis.net/cat/csw/2.0.2">http://www.opengis.net/cat/csw/2.0.2</a> - a dublin core derivative</p></li>
<li><p><strong>iso</strong> - <a class="reference external" href="http://www.isotc211.org/2005/gmd">http://www.isotc211.org/2005/gmd</a> - ISO19115/19139</p></li>
</ul>
<p>From each of these output schemas, a <strong>brief</strong>, <strong>summary</strong> or <strong>full</strong> element
set can be requested.</p>
<p>These output schemas and element sets are implemented in GeoNetwork as XSLTs and
they are stored in the ‘csw’ subdirectory of the ‘present’ directory. The ogc
output schema XSLTs are implemented as ogc-brief.xsl, ogc-summary and
ogc-full.xsl. The iso output schema XSLTs are implemented as iso-brief.xsl,
iso-summary.xsl and iso-full.xsl.</p>
<p>To create these XSLTs for the MCP, the best option is to copy and modify
the csw presentation XSLTs from the base schema iso19139.</p>
<p>After creating the presentation XSLTs, our new GeoNetwork plugin schema
for MCP contains:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">extract</span><span class="o">-</span><span class="n">date</span><span class="o">-</span><span class="n">modified</span><span class="o">.</span><span class="n">xsl</span>  <span class="n">extract</span><span class="o">-</span><span class="n">gml</span><span class="o">.</span><span class="n">xsd</span>  <span class="n">extract</span><span class="o">-</span><span class="n">uuid</span><span class="o">.</span><span class="n">xsl</span>
<span class="n">loc</span>  <span class="n">present</span>  <span class="n">schema</span><span class="o">-</span><span class="n">conversions</span><span class="o">.</span><span class="n">xml</span>  <span class="n">schema</span><span class="o">-</span><span class="n">ident</span><span class="o">.</span><span class="n">xml</span>  <span class="n">schema</span><span class="o">.</span><span class="n">xsd</span>
<span class="n">schema</span>
</pre></div>
</div>
</section>
<section id="creating-the-index-fields-xsl-to-index-content-from-the-metadata-record">
<h4>Creating the index-fields.xsl to index content from the metadata record<a class="headerlink" href="#creating-the-index-fields-xsl-to-index-content-from-the-metadata-record" title="Permalink to this heading">¶</a></h4>
<p>This XSLT indexes the content of elements in the metadata record.
The essence of this XSLT is to select elements from the metadata record and
map them to lucene index field names. The lucene index field names used in
GeoNetwork are as follows:</p>
<table class="docutils align-default">
<thead>
<tr class="row-odd"><th class="head"><p>Lucene Index Field Name</p></th>
<th class="head"><p>Description</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>abstract</p></td>
<td><p>Metadata abstract</p></td>
</tr>
<tr class="row-odd"><td><p>any</p></td>
<td><p>Content from all metadata elements (for free text)</p></td>
</tr>
<tr class="row-even"><td><p>changeDate</p></td>
<td><p>Date that the metadata record was modified</p></td>
</tr>
<tr class="row-odd"><td><p>createDate</p></td>
<td><p>Date that the metadata record was created</p></td>
</tr>
<tr class="row-even"><td><p>denominator</p></td>
<td><p>Scale denominator in data resolution</p></td>
</tr>
<tr class="row-odd"><td><p>download</p></td>
<td><p>Does the metadata record have a downloadable resource attached?  (0 or 1)</p></td>
</tr>
<tr class="row-even"><td><p>digital</p></td>
<td><p>Is the metadata record distributed/available in a digital format?  (0 or 1)</p></td>
</tr>
<tr class="row-odd"><td><p>eastBL</p></td>
<td><p>East bounding box longitude</p></td>
</tr>
<tr class="row-even"><td><p>keyword</p></td>
<td><p>Metadata keywords</p></td>
</tr>
<tr class="row-odd"><td><p>metadataStandardName</p></td>
<td><p>Metadata standard name</p></td>
</tr>
<tr class="row-even"><td><p>northBL</p></td>
<td><p>North bounding box latitude</p></td>
</tr>
<tr class="row-odd"><td><p>operatesOn</p></td>
<td><p>Uuid of metadata record describing dataset that is operated on by a service</p></td>
</tr>
<tr class="row-even"><td><p>orgName</p></td>
<td><p>Name of organisation listed in point-of-contact information</p></td>
</tr>
<tr class="row-odd"><td><p>parentUuid</p></td>
<td><p>Uuid of parent metadata record</p></td>
</tr>
<tr class="row-even"><td><p>paper</p></td>
<td><p>Is the metadata record distributed/available in a paper format?  (0 or 1)</p></td>
</tr>
<tr class="row-odd"><td><p>protocol</p></td>
<td><p>On line resource access protocol</p></td>
</tr>
<tr class="row-even"><td><p>publicationDate</p></td>
<td><p>Date resource was published</p></td>
</tr>
<tr class="row-odd"><td><p>southBL</p></td>
<td><p>South bounding box latitude</p></td>
</tr>
<tr class="row-even"><td><p>spatialRepresentationType</p></td>
<td><p>vector, raster, etc</p></td>
</tr>
<tr class="row-odd"><td><p>tempExtentBegin</p></td>
<td><p>Beginning of temporal extent range</p></td>
</tr>
<tr class="row-even"><td><p>tempExtentEnd</p></td>
<td><p>End of temporal extent range</p></td>
</tr>
<tr class="row-odd"><td><p>title</p></td>
<td><p>Metadata title</p></td>
</tr>
<tr class="row-even"><td><p>topicCat</p></td>
<td><p>Metadata topic category</p></td>
</tr>
<tr class="row-odd"><td><p>type</p></td>
<td><p>Metadata hierarchy level (should be dataset if unknown)</p></td>
</tr>
<tr class="row-even"><td><p>westBL</p></td>
<td><p>West bounding box longitude</p></td>
</tr>
</tbody>
</table>
<p>For example, here is the mapping created between the metadata element
mcp:revisionDate and the lucene index field changeDate:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;xsl:for-each</span><span class="w"> </span><span class="na">select=</span><span class="s">&quot;mcp:revisionDate/*&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;Field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;changeDate&quot;</span><span class="w"> </span><span class="na">string=</span><span class="s">&quot;{string(.)}&quot;</span><span class="w"> </span><span class="na">store=</span><span class="s">&quot;true&quot;</span><span class="w"> </span><span class="na">index=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/xsl:for-each&gt;</span>
</pre></div>
</div>
<p>Notice that we are creating a new XML document. The Field elements in this
document are read by GeoNetwork to create a Lucene document object for indexing
(see the SearchManager class in the GeoNetwork source).</p>
<p>Once again, because the MCP is a profile of ISO19115/19139, it is probably best
to modify <code class="docutils literal notranslate"><span class="pre">index-fields.xsl</span></code> from the schema iso19139 to handle the namespaces
and additional elements of the MCP.</p>
<p>At this stage, our new GeoNetwork plugin schema for MCP contains:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">extract</span><span class="o">-</span><span class="n">date</span><span class="o">-</span><span class="n">modified</span><span class="o">.</span><span class="n">xsl</span>  <span class="n">extract</span><span class="o">-</span><span class="n">gml</span><span class="o">.</span><span class="n">xsd</span>  <span class="n">extract</span><span class="o">-</span><span class="n">uuid</span><span class="o">.</span><span class="n">xsl</span>
<span class="n">index</span><span class="o">-</span><span class="n">fields</span><span class="o">.</span><span class="n">xsl</span>  <span class="n">loc</span>  <span class="n">present</span>  <span class="n">schema</span><span class="o">-</span><span class="n">conversions</span><span class="o">.</span><span class="n">xml</span>  <span class="n">schema</span><span class="o">-</span><span class="n">ident</span><span class="o">.</span><span class="n">xml</span>
<span class="n">schema</span><span class="o">.</span><span class="n">xsd</span>  <span class="n">schema</span>
</pre></div>
</div>
</section>
<section id="creating-the-sample-data-directory">
<h4>Creating the sample-data directory<a class="headerlink" href="#creating-the-sample-data-directory" title="Permalink to this heading">¶</a></h4>
<p>This is a simple directory. Put MEF files with sample metadata in this directory.
Make sure they have a <code class="docutils literal notranslate"><span class="pre">.mef</span></code> suffix.</p>
<p>A MEF file is a zip archive with the metadata, thumbnails, file based online
resources and an info file describing the contents. The contents of a MEF file
are discussed in more detail in the next section of this manual.</p>
<p>Sample data in this directory can be added to the catalog using the
Administration menu.</p>
<p>At this stage, our new GeoNetwork plugin schema for MCP contains:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">extract</span><span class="o">-</span><span class="n">date</span><span class="o">-</span><span class="n">modified</span><span class="o">.</span><span class="n">xsl</span>  <span class="n">extract</span><span class="o">-</span><span class="n">gml</span><span class="o">.</span><span class="n">xsd</span>  <span class="n">extract</span><span class="o">-</span><span class="n">uuid</span><span class="o">.</span><span class="n">xsl</span>
<span class="n">index</span><span class="o">-</span><span class="n">fields</span><span class="o">.</span><span class="n">xsl</span>  <span class="n">loc</span>  <span class="n">present</span>  <span class="n">sample</span><span class="o">-</span><span class="n">data</span> <span class="n">schema</span><span class="o">-</span><span class="n">ident</span><span class="o">.</span><span class="n">xml</span>  <span class="n">schema</span><span class="o">.</span><span class="n">xsd</span>
<span class="n">schema</span>
</pre></div>
</div>
</section>
<section id="creating-schematrons-to-describe-mcp-conditions">
<h4>Creating schematrons to describe MCP conditions<a class="headerlink" href="#creating-schematrons-to-describe-mcp-conditions" title="Permalink to this heading">¶</a></h4>
<p>Schematrons are rules that are used to check conditions and content in the
metadata record as part of the two stage validation process used by GeoNetwork.</p>
<p>Schematron rules are created in the schematrons directory that you checked
out earlier - see <a class="reference internal" href="#preparation"><span class="std std-ref">Preparation</span></a> above.</p>
<p>An example rule is:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="cm">&lt;!-- anzlic/trunk/gml/3.2.0/gmd/spatialRepresentation.xsd--&gt;</span>
<span class="cm">&lt;!-- TEST 12 --&gt;</span>
<span class="nt">&lt;sch:pattern&gt;</span>
<span class="w">  </span><span class="nt">&lt;sch:title&gt;</span>$loc/strings/M30<span class="nt">&lt;/sch:title&gt;</span>
<span class="w">  </span><span class="nt">&lt;sch:rule</span><span class="w"> </span><span class="na">context=</span><span class="s">&quot;//gmd:MD_Georectified&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;sch:let</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;cpd&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;(gmd:checkPointAvailability/gco:Boolean=&#39;1&#39; or gmd:checkPointAvailability/gco:Boolean=&#39;true&#39;) and</span>
<span class="s">      (not(gmd:checkPointDescription) or count(gmd:checkPointDescription[@gco:nilReason=&#39;missing&#39;])&gt;0)&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;sch:assert</span>
<span class="w">      </span><span class="na">test=</span><span class="s">&quot;$cpd = false()&quot;</span>
<span class="w">      </span><span class="nt">&gt;</span>$loc/strings/alert.M30<span class="nt">&lt;/sch:assert&gt;</span>
<span class="w">    </span><span class="nt">&lt;sch:report</span>
<span class="w">      </span><span class="na">test=</span><span class="s">&quot;$cpd = false()&quot;</span>
<span class="w">      </span><span class="nt">&gt;</span>$loc/strings/report.M30<span class="nt">&lt;/sch:report&gt;</span>
<span class="w">  </span><span class="nt">&lt;/sch:rule&gt;</span>
<span class="nt">&lt;/sch:pattern&gt;</span>
</pre></div>
</div>
<p>As for most of GeoNetwork, the output of this rule can be localized to different
languages. The corresponding localized strings are:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;strings&gt;</span>

<span class="w">  </span>.....

<span class="w">  </span><span class="nt">&lt;M30&gt;</span>[ISOFTDS19139:2005-TableA1-Row15]<span class="w"> </span>-<span class="w"> </span>Check<span class="w"> </span>point<span class="w"> </span>description<span class="w"> </span>required<span class="w"> </span>if<span class="w"> </span>available<span class="nt">&lt;/M30&gt;</span>

<span class="w">  </span>.....

<span class="w">  </span><span class="nt">&lt;alert.M30&gt;&lt;div&gt;</span>&#39;checkPointDescription&#39;<span class="w"> </span>is<span class="w"> </span>mandatory<span class="w"> </span>if<span class="w"> </span>&#39;checkPointAvailability&#39;<span class="w"> </span>=<span class="w"> </span>1<span class="w"> </span>or<span class="w"> </span>true.<span class="nt">&lt;/div&gt;&lt;/alert.M30&gt;</span>

<span class="w">  </span>.....

<span class="w">  </span><span class="nt">&lt;report.M30&gt;</span>Check<span class="w"> </span>point<span class="w"> </span>description<span class="w"> </span>documented.<span class="nt">&lt;/report.M30&gt;</span>

<span class="w">  </span>.....

<span class="nt">&lt;/strings&gt;</span>
</pre></div>
</div>
<p>Procedure for adding schematron rules, working within the schematrons directory:</p>
<ol class="arabic simple">
<li><p>Place your schematron rules in ‘rules’. Naming convention is
‘schematron-rules-&lt;suffix&gt;.sch’ eg. <code class="docutils literal notranslate"><span class="pre">schematron-rules-iso-mcp.sch</span></code>.
Place localized strings for the rule assertions into ‘rules/loc/&lt;language_prefix&gt;’.</p></li>
</ol>
<p>Schematron rules are compiled when the schema is loaded.</p>
<p>At this stage, our new GeoNetwork plugin schema for MCP contains:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">extract</span><span class="o">-</span><span class="n">date</span><span class="o">-</span><span class="n">modified</span><span class="o">.</span><span class="n">xsl</span>  <span class="n">extract</span><span class="o">-</span><span class="n">gml</span><span class="o">.</span><span class="n">xsd</span>  <span class="n">extract</span><span class="o">-</span><span class="n">uuid</span><span class="o">.</span><span class="n">xsl</span>
<span class="n">index</span><span class="o">-</span><span class="n">fields</span><span class="o">.</span><span class="n">xsl</span>  <span class="n">loc</span>  <span class="n">present</span>  <span class="n">sample</span><span class="o">-</span><span class="n">data</span>  <span class="n">schema</span><span class="o">-</span><span class="n">conversions</span><span class="o">.</span><span class="n">xml</span>
<span class="n">schema</span><span class="o">-</span><span class="n">ident</span><span class="o">.</span><span class="n">xml</span>  <span class="n">schema</span><span class="o">.</span><span class="n">xsd</span>  <span class="n">schema</span>  <span class="n">schematron</span><span class="o">/</span><span class="n">schematron</span><span class="o">-</span><span class="n">rules</span><span class="o">-</span><span class="n">iso</span><span class="o">-</span><span class="n">mcp</span><span class="o">.</span><span class="n">sch</span>
</pre></div>
</div>
</section>
<section id="adding-the-components-necessary-to-create-and-edit-mcp-metadata">
<h4>Adding the components necessary to create and edit MCP metadata<a class="headerlink" href="#adding-the-components-necessary-to-create-and-edit-mcp-metadata" title="Permalink to this heading">¶</a></h4>
<p>So far we have added all the components necessary for GeoNetwork to identify,
view and validate MCP metadata records. Now we will add the remaining components
necessary to create and edit MCP metadata records.</p>
<p>We’ll start with the XSLTs that set the content of various elements in the MCP
metadata records.</p>
</section>
<section id="creating-set-uuid-xsl">
<h4>Creating set-uuid.xsl<a class="headerlink" href="#creating-set-uuid-xsl" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p><strong>set-uuid.xsl</strong> - this XSLT takes as a parameter the UUID of the metadata
record and writes it into the appropriate element of the metadata record.
For the MCP this element is the same as the base ISO schema (called iso19139
in GeoNetwork), namely gmd:fileIdentifier. However, because the MCP uses a
different namespace on the root element, this XSLT needs to be modified.</p></li>
</ul>
</section>
<section id="creating-the-extract-set-and-unset-thumbnail-xslts">
<h4>Creating the extract, set and unset thumbnail XSLTs<a class="headerlink" href="#creating-the-extract-set-and-unset-thumbnail-xslts" title="Permalink to this heading">¶</a></h4>
<p>If your metadata record can have a thumbnail or browse graphic link, then
you will want to add XSLTs that extract, set and unset this information
so that you can use the GeoNetwork thumbnail editing interface.</p>
<p>The three XSLTs that support this interface are:</p>
<ul class="simple">
<li><p><strong>extract-thumbnails.xsl</strong> - this XSLT extracts the thumbnails/browse graphics
from the metadata record, turning it into generic XML that is the same for all
metadata schemas. The elements need to have content that GeoNetwork understands.
The following is an example of what the thumbnail interface for iso19139 expects
(we’ll duplicate this requirement for MCP):</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;gmd:graphicOverview&gt;</span>
<span class="w">  </span><span class="nt">&lt;gmd:MD_BrowseGraphic&gt;</span>
<span class="w">    </span><span class="nt">&lt;gmd:fileName&gt;</span>
<span class="w">      </span><span class="nt">&lt;gco:CharacterString&gt;</span>bluenet_s.png<span class="nt">&lt;/gco:CharacterString&gt;</span>
<span class="w">    </span><span class="nt">&lt;/gmd:fileName&gt;</span>
<span class="w">    </span><span class="nt">&lt;gmd:fileDescription&gt;</span>
<span class="w">      </span><span class="nt">&lt;gco:CharacterString&gt;</span>thumbnail<span class="nt">&lt;/gco:CharacterString&gt;</span>
<span class="w">    </span><span class="nt">&lt;/gmd:fileDescription&gt;</span>
<span class="w">    </span><span class="nt">&lt;gmd:fileType&gt;</span>
<span class="w">      </span><span class="nt">&lt;gco:CharacterString&gt;</span>png<span class="nt">&lt;/gco:CharacterString&gt;</span>
<span class="w">    </span><span class="nt">&lt;/gmd:fileType&gt;</span>
<span class="w">  </span><span class="nt">&lt;/gmd:MD_BrowseGraphic&gt;</span>
<span class="nt">&lt;/gmd:graphicOverview&gt;</span>
<span class="nt">&lt;gmd:graphicOverview&gt;</span>
<span class="w">  </span><span class="nt">&lt;gmd:MD_BrowseGraphic&gt;</span>
<span class="w">    </span><span class="nt">&lt;gmd:fileName&gt;</span>
<span class="w">      </span><span class="nt">&lt;gco:CharacterString&gt;</span>bluenet.png<span class="nt">&lt;/gco:CharacterString&gt;</span>
<span class="w">    </span><span class="nt">&lt;/gmd:fileName&gt;</span>
<span class="w">    </span><span class="nt">&lt;gmd:fileDescription&gt;</span>
<span class="w">      </span><span class="nt">&lt;gco:CharacterString&gt;</span>large_thumbnail<span class="nt">&lt;/gco:CharacterString&gt;</span>
<span class="w">    </span><span class="nt">&lt;/gmd:fileDescription&gt;</span>
<span class="w">    </span><span class="nt">&lt;gmd:fileType&gt;</span>
<span class="w">      </span><span class="nt">&lt;gco:CharacterString&gt;</span>png<span class="nt">&lt;/gco:CharacterString&gt;</span>
<span class="w">    </span><span class="nt">&lt;/gmd:fileType&gt;</span>
<span class="w">  </span><span class="nt">&lt;/gmd:MD_BrowseGraphic&gt;</span>
<span class="nt">&lt;/gmd:graphicOverview&gt;</span>
</pre></div>
</div>
<p>When <code class="docutils literal notranslate"><span class="pre">extract-thumbnails.xsl</span></code> is run, it creates a small XML hierarchy
from this information which looks something like the following:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;thumbnail&gt;</span>
<span class="w">  </span><span class="nt">&lt;large&gt;</span>
<span class="w">    </span>bluenet.png
<span class="w">  </span><span class="nt">&lt;/large&gt;</span>
<span class="w">  </span><span class="nt">&lt;small&gt;</span>
<span class="w">    </span>bluenet_s.png
<span class="w">  </span><span class="nt">&lt;/small&gt;</span>
<span class="nt">&lt;/thumbnail&gt;</span>
</pre></div>
</div>
<ul class="simple">
<li><p><strong>set-thumbnail.xsl</strong> - this XSLT does the opposite of extract-thumbnails.xsl.
It takes the simplified, common XML structure used by GeoNetwork to describe
the large and small thumbnails and creates the elements of the metadata
record that are needed to represent them. This is a slightly more
complex XSLT than extract-thumbnails.xsl because the existing elements
in the metadata record need to be retained and the new elements need to
be created in their correct places.</p></li>
<li><p><strong>unset-thumbnail.xsl</strong> - this XSLT targets and removes elements of the
metadata record that describe a particular thumbnail. The remaining elements
of the metadata record are retained.</p></li>
</ul>
<p>Because the MCP is a profile of ISO19115/19139, the easiest path to creating
these XSLTs is to copy them from the iso19139 schema and modify them for the
changes in namespace required by the MCP.</p>
</section>
<section id="creating-the-update-xslts">
<h4>Creating the update-… XSLTs<a class="headerlink" href="#creating-the-update-xslts" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p><strong>update-child-from-parent-info.xsl</strong> - this XSLT is run when a child
record needs to have content copied into it from a parent record.
It is an XSLT that changes the content of a few elements and leaves the
remaining elements untouched. The behaviour of this XSLT would depend
on which elements of the parent record will be used to update elements
of the child record.</p></li>
<li><p><strong>update-fixed-info.xsl</strong> - this XSLT is run after editing to fix
certain elements and content in the metadata record. For the MCP there
are a number of actions we would like to take to ‘hard-wire’ certain
elements and content. To do this the XSLT the following processing logic:</p></li>
</ul>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">if</span> <span class="n">the</span> <span class="n">element</span> <span class="ow">is</span> <span class="n">one</span> <span class="n">that</span> <span class="n">we</span> <span class="n">want</span> <span class="n">to</span> <span class="n">process</span> <span class="n">then</span>
  <span class="n">add</span> <span class="n">a</span> <span class="n">template</span> <span class="k">with</span> <span class="n">a</span> <span class="n">match</span> <span class="n">condition</span> <span class="k">for</span> <span class="n">that</span> <span class="n">element</span> <span class="ow">and</span> <span class="n">process</span> <span class="n">it</span>
<span class="k">else</span> <span class="n">copy</span> <span class="n">the</span> <span class="n">element</span> <span class="n">to</span> <span class="n">output</span>
</pre></div>
</div>
<p>Because the MCP is a profile of ISO19115/19139, the easiest path to
creating this XSLT is to copy update-fixed-info.xsl from the iso19139
schema and modify it for the changes in namespace required by the MCP
and then to include the processing we want.</p>
<p>A simple example of MCP processing is to make sure that the
gmd:metadataStandardName and gmd:metadataStandardVersion elements
have the content needed to ensure that the record is recognized as MCP.
To do this we can add two templates as follows:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;xsl:template</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;gmd:metadataStandardName&quot;</span><span class="w"> </span><span class="na">priority=</span><span class="s">&quot;10&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;xsl:copy&gt;</span>
<span class="w">    </span><span class="nt">&lt;gco:CharacterString&gt;</span>Australian<span class="w"> </span>Marine<span class="w"> </span>Community<span class="w"> </span>Profile<span class="w"> </span>of<span class="w"> </span>ISO<span class="w"> </span>19115:2005/19139<span class="nt">&lt;/gco:CharacterString&gt;</span>
<span class="w">  </span><span class="nt">&lt;/xsl:copy&gt;</span>
<span class="nt">&lt;/xsl:template&gt;</span>

<span class="nt">&lt;xsl:template</span><span class="w"> </span><span class="na">match=</span><span class="s">&quot;gmd:metadataStandardVersion&quot;</span><span class="w"> </span><span class="na">priority=</span><span class="s">&quot;10&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;xsl:copy&gt;</span>
<span class="w">    </span><span class="nt">&lt;gco:CharacterString&gt;</span>MCP:BlueNet<span class="w"> </span>V1.5<span class="nt">&lt;/gco:CharacterString&gt;</span>
<span class="w">  </span><span class="nt">&lt;/xsl:copy&gt;</span>
<span class="nt">&lt;/xsl:template&gt;</span>
</pre></div>
</div>
<p>Processing by <code class="docutils literal notranslate"><span class="pre">update-fixed-info.xsl</span></code> can be enabled/disabled using the
<em>Automatic Fixes</em> check box in the System Configuration menu.
By default, it is enabled.</p>
<p>Some important tasks handled in <code class="docutils literal notranslate"><span class="pre">upgrade-fixed-info.xsl</span></code>:</p>
<ul class="simple">
<li><p>creating URLs for metadata with attached files (eg. onlineResources
with ‘File for download’ in iso19139)</p></li>
<li><p>setting date stamp/revision date</p></li>
<li><p>setting codelist URLs to point to online ISO codelist catalogs</p></li>
<li><p>adding default spatial reference system attributes to spatial extents</p></li>
</ul>
<p>A specific task required for the MCP <code class="docutils literal notranslate"><span class="pre">update-fixed-info.xsl</span></code> was to
automatically create an online resource with a URL pointing to the
metadata.show service with parameter set to the metadata uuid.
This required some changes to the update-fixed-info.xsl supplied with
iso19139. In particular:</p>
<ul class="simple">
<li><p>the parent elements may not be present in the metadata record</p></li>
<li><p>processing of the online resource elements for the metadata point
of truth URL should not interfere with other processing of online resource elements</p></li>
</ul>
<p>Rather than describe the individual steps required to implement this
and the decisions required in the XSLT language, take a look at the
<code class="docutils literal notranslate"><span class="pre">update-fixed-info.xsl</span></code> already present for the MCP schema in the
iso19139.mcp directory and refer to the dot points above.</p>
</section>
<section id="creating-the-templates-directory">
<h4>Creating the templates directory<a class="headerlink" href="#creating-the-templates-directory" title="Permalink to this heading">¶</a></h4>
<p>This is a simple directory. Put XML metadata files to be used as templates in
this directory. Make sure they have a <code class="docutils literal notranslate"><span class="pre">.xml</span></code> suffix. Templates in this
directory can be added to the catalog using the Administration menu.</p>
</section>
<section id="editor-behaviour-adding-schema-suggestions-xml-and-schema-substitutes-xml">
<h4>Editor behaviour: Adding schema-suggestions.xml and schema-substitutes.xml<a class="headerlink" href="#editor-behaviour-adding-schema-suggestions-xml-and-schema-substitutes-xml" title="Permalink to this heading">¶</a></h4>
<ul class="simple">
<li><p><strong>schema-suggestions.xml</strong> - The default behaviour of the GeoNetwork advanced
editor when building the editor forms is to show elements that are not in the
metadata record as unexpanded elements. To add these elements to the record,
the user will have to click on the ‘+’ icon next to the element name. This can
be tedious especially as some metadata standards have elements nested in
others (ie. complex elements). The schema-suggestions.xml file allows you to
specify elements that should be automatically expanded by the editor.
An example of this is the online resource information in the ISO19115/19139
standard. If the following XML was added to the <code class="docutils literal notranslate"><span class="pre">schema-suggestions.xml</span></code> file:</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;gmd:CI_OnlineResource&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;suggest</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;gmd:protocol&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;suggest</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;gmd:name&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;suggest</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;gmd:description&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/field&gt;</span>
</pre></div>
</div>
<p>The effect of this would be that when an online resource element was expanded,
then input fields for the protocol (a drop down/select list), name and
description would automatically appear in the editor.</p>
<p>Once again, a good place to start when building a <code class="docutils literal notranslate"><span class="pre">schema-suggestions.xml</span></code>
file for the MCP is the <code class="docutils literal notranslate"><span class="pre">schema-suggestions.xml</span></code> file for the iso19139 schema.</p>
<ul class="simple">
<li><p><strong>schema-substitutes.xml</strong> - Recall from the earlier <a class="reference internal" href="#schema-and-schema-xsd"><span class="std std-ref">Creating the schema directory and schema.xsd file</span></a>
section, that the method we used to extend the base ISO19115/19139 schemas is to
extend the base type, define a new element with the extended base type and allow
the new element to substitute for the base element. So for example, in the MCP,
we want to add a new resource constraint element that holds Creative Commons
and other commons type licensing information. This requires that the MD_Constraints
type be extended and a new mcp:MD_Commons element be defined which can substitute
for gmd:MD_Constraints. This is shown in the following snippet of XSD:</p></li>
</ul>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;xs:complexType</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;MD_CommonsConstraints_Type&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;xs:annotation&gt;</span>
<span class="w">    </span><span class="nt">&lt;xs:documentation&gt;</span>
<span class="w">      </span>Add<span class="w"> </span>MD_Commons<span class="w"> </span>as<span class="w"> </span>an<span class="w"> </span>extension<span class="w"> </span>of<span class="w"> </span>gmd:MD_Constraints_Type
<span class="w">    </span><span class="nt">&lt;/xs:documentation&gt;</span>
<span class="w">  </span><span class="nt">&lt;/xs:annotation&gt;</span>
<span class="w">  </span><span class="nt">&lt;xs:complexContent&gt;</span>
<span class="w">    </span><span class="nt">&lt;xs:extension</span><span class="w"> </span><span class="na">base=</span><span class="s">&quot;gmd:MD_Constraints_Type&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;xs:sequence</span><span class="w"> </span><span class="na">minOccurs=</span><span class="s">&quot;0&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;xs:element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;jurisdictionLink&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;gmd:URL_PropertyType&quot;</span><span class="w"> </span><span class="na">minOccurs=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;xs:element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;licenseLink&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;gmd:URL_PropertyType&quot;</span><span class="w"> </span><span class="na">minOccurs=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;xs:element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;imageLink&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;gmd:URL_PropertyType&quot;</span><span class="w"> </span><span class="na">minOccurs=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;xs:element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;licenseName&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;gco:CharacterString_PropertyType&quot;</span><span class="w"> </span><span class="na">minOccurs=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;xs:element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;attributionConstraints&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;gco:CharacterString_PropertyType&quot;</span><span class="w"> </span><span class="na">minOccurs=</span><span class="s">&quot;0&quot;</span><span class="w"> </span><span class="na">maxOccurs=</span><span class="s">&quot;unbounded&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;xs:element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;derivativeConstraints&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;gco:CharacterString_PropertyType&quot;</span><span class="w"> </span><span class="na">minOccurs=</span><span class="s">&quot;0&quot;</span><span class="w"> </span><span class="na">maxOccurs=</span><span class="s">&quot;unbounded&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;xs:element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;commercialUseConstraints&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;gco:CharacterString_PropertyType&quot;</span><span class="w"> </span><span class="na">minOccurs=</span><span class="s">&quot;0&quot;</span><span class="w"> </span><span class="na">maxOccurs=</span><span class="s">&quot;unbounded&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;xs:element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;collectiveWorksConstraints&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;gco:CharacterString_PropertyType&quot;</span><span class="w"> </span><span class="na">minOccurs=</span><span class="s">&quot;0&quot;</span><span class="w"> </span><span class="na">maxOccurs=</span><span class="s">&quot;unbounded&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;xs:element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;otherConstraints&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;gco:CharacterString_PropertyType&quot;</span><span class="w"> </span><span class="na">minOccurs=</span><span class="s">&quot;0&quot;</span><span class="w"> </span><span class="na">maxOccurs=</span><span class="s">&quot;unbounded&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;/xs:sequence&gt;</span>
<span class="w">      </span><span class="nt">&lt;xs:attribute</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;mcp:commonsType&quot;</span><span class="w"> </span><span class="na">use=</span><span class="s">&quot;required&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;xs:attribute</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;gco:isoType&quot;</span><span class="w"> </span><span class="na">use=</span><span class="s">&quot;required&quot;</span><span class="w"> </span><span class="na">fixed=</span><span class="s">&quot;gmd:MD_Constraints&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/xs:extension&gt;</span>
<span class="w">  </span><span class="nt">&lt;/xs:complexContent&gt;</span>
<span class="nt">&lt;/xs:complexType&gt;</span>

<span class="nt">&lt;xs:element</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;MD_Commons&quot;</span><span class="w"> </span><span class="na">substitutionGroup=</span><span class="s">&quot;gmd:MD_Constraints&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;mcp:MD_CommonsConstraints_Type&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>For MCP records, the GeoNetwork editor will show a choice of elements from the
substitution group for gmd:MD_Constraints when adding ‘Resource Constraints’
to the metadata document. This will now include mcp:MD_Commons.</p>
<figure class="align-default">
<img alt="../_images/Editor-Constraints-Choices.png" src="../_images/Editor-Constraints-Choices.png" />
</figure>
<p>Note that by similar process, two other elements, now deprecated in favour of
MD_Commons, were also added as substitutes for MD_Constraints. If it was necessary
to constrain the choices shown in this menu, say to remove the deprecated elements
and limit the choices to just legal, security and commons, then this can be done
by the following piece of XML in the schema-substitutes.xml file:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;field</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;gmd:MD_Constraints&quot;</span><span class="nt">&gt;</span>
<span class="w">  </span><span class="nt">&lt;substitute</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;gmd:MD_LegalConstraints&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;substitute</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;gmd:MD_SecurityConstraints&quot;</span><span class="nt">/&gt;</span>
<span class="w">  </span><span class="nt">&lt;substitute</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;mcp:MD_Commons&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/field&gt;</span>
</pre></div>
</div>
<p>The result of this change is shown below.</p>
<figure class="align-default">
<img alt="../_images/Editor-Constraints-Choices-Modified.png" src="../_images/Editor-Constraints-Choices-Modified.png" />
</figure>
<p>Once again, a good place to start when building a schema-substitutes.xml file
for the MCP is the schema-substitutes.xml file for the iso19139 schema.</p>
</section>
<section id="adding-components-to-support-conversion-of-metadata-records-to-other-schemas">
<h4>Adding components to support conversion of metadata records to other schemas<a class="headerlink" href="#adding-components-to-support-conversion-of-metadata-records-to-other-schemas" title="Permalink to this heading">¶</a></h4>
</section>
<section id="creating-the-convert-directory">
<h4>Creating the convert directory<a class="headerlink" href="#creating-the-convert-directory" title="Permalink to this heading">¶</a></h4>
<p>If the new GeoNetwork plugin schema is to support on the fly translation of
metadata records to other schemas, then the convert directory should be
created and populated with appropriate XSLTs.</p>
</section>
<section id="supporting-oaipmh-conversions">
<h4>Supporting OAIPMH conversions<a class="headerlink" href="#supporting-oaipmh-conversions" title="Permalink to this heading">¶</a></h4>
<p>The OAIPMH server in GeoNetwork can deliver metadata records from any
of the schemas known to GeoNetwork. It can also be configured to deliver
schemas not known to GeoNetwork if an XSLT exists to convert a metadata
record to that schema. The file <code class="docutils literal notranslate"><span class="pre">INSTALL_DIR/web/geonetwork/WEB-INF/config-oai-prefixes.xml</span></code>
describes the schemas (known as prefixes in OAI speak) that can be produced by an XSLT.
A simple example of the content of this file is shown below:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;schemas&gt;</span>
<span class="w">  </span><span class="nt">&lt;schema</span><span class="w"> </span><span class="na">prefix=</span><span class="s">&quot;oai_dc&quot;</span><span class="w"> </span><span class="na">nsUrl=</span><span class="s">&quot;http://www.openarchives.org/OAI/2.0/&quot;</span>
<span class="w">          </span><span class="na">schemaLocation=</span><span class="s">&quot;http://www.openarchives.org/OAI/2.0/oai_dc.xsd&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/schemas&gt;</span>
</pre></div>
</div>
<p>In the case of the prefix oai_dc shown above, if a schema converter with
prefix <em>oai_dc</em> exists in the <code class="docutils literal notranslate"><span class="pre">schema-conversions.xml</span></code> file of a
GeoNetwork schema, then records that belong to this schema will be
transformed and included in OAIPMH requests for the <em>oai_dc</em> prefix.
See <a class="reference internal" href="#schema-conversions"><span class="std std-ref">Creating the schema-conversions.xml file</span></a> for more info.</p>
<p>To add oai_dc support for the MCP, the easiest method is to copy oai_dc.xsl
from the convert directory of the iso19139 schema, modify it to cope with the
different namespaces and additional elements of the MCP and add it to the
<code class="docutils literal notranslate"><span class="pre">schema-conversions.xml</span></code> file for the MCP.</p>
</section>
</section>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="adding-static-pages.html" class="btn btn-neutral float-left" title="Adding static pages" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="characterset.html" class="btn btn-neutral float-right" title="Characterset" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2001-2023, GeoNetwork opensource. Licensed under Creative Commons Attribution ShareAlike (Unported) v3.0 License.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>