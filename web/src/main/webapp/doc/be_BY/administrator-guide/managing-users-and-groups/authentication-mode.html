<!DOCTYPE html>
<html class="writer-html5" lang="be-BY" >
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Рэжым аўтэнтыфікацыі &mdash; GeoNetwork opensource v3.12 GeoNetwork Documentation</title>
      <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
        <script src="../../_static/jquery.js"></script>
        <script src="../../_static/underscore.js"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js"></script>
        <script src="../../_static/doctools.js"></script>
        <script src="../../_static/sphinx_highlight.js"></script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Кіруючая сістэма класіфікацыі" href="../managing-classification-systems/index.html" />
    <link rel="prev" title="Самарэгістрацыя карыстальніка" href="user-self-registration.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
            <a href="../../index.html" class="icon icon-home"> GeoNetwork opensource
          </a>
              <div class="version">
                3.12
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../../overview/index.html">Агляд</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../install-guide/index.html">Installation guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../user-guide/index.html">Кіраўніцтва карыстальніка</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../index.html">Кіраўніцтва адміністратара</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="../configuring-the-catalog/index.html">Канфігурацыя каталога</a></li>
<li class="toctree-l2 current"><a class="reference internal" href="index.html">Кіраванне карыстальнікамі і групамі</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="creating-group.html">Стварэнне групы</a></li>
<li class="toctree-l3"><a class="reference internal" href="creating-user.html">Стварэнне карыстальніка</a></li>
<li class="toctree-l3"><a class="reference internal" href="user-self-registration.html">Самарэгістрацыя карыстальніка</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="#">Рэжым аўтэнтыфікацыі</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#configuring-ldap">Налада LDAP</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-ldap-hierarchy">Configuring LDAP - Hierarchy</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-cas">Налада CAS</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-keycloak">Configuring Keycloak</a></li>
<li class="toctree-l4"><a class="reference internal" href="#configuring-shibboleth">Налада Shibboleth</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="index.html#default-user">Карыстальнік па змаўчанні</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#user-session">Сесія карыстальніка</a></li>
<li class="toctree-l3"><a class="reference internal" href="index.html#users-groups-and-roles">Карыстальнікі, групы і ролі</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../managing-classification-systems/index.html">Кіруючая сістэма класіфікацыі</a></li>
<li class="toctree-l2"><a class="reference internal" href="../managing-metadata-standards/index.html">Managing metadata &amp; template</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../../maintainer-guide/index.html">Кіраўніцтва па эксплуатацыі</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/index.html">Кіраўніцтва па API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/index.html">Кіраўніцтва па ўкладзе</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../customizing-application/index.html">Iнсткукцыя па наладцы</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorials/index.html">Падручнікі</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../annexes/index.html">Дадаткі</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">GeoNetwork opensource</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../index.html">Кіраўніцтва адміністратара</a> &raquo;</li>
          <li><a href="index.html">Кіраванне карыстальнікамі і групамі</a> &raquo;</li>
      <li>Рэжым аўтэнтыфікацыі</li>
      <li class="wy-breadcrumbs-aside">
              <a href="https://github.com/geonetwork/doc/blob/develop/source/administrator-guide/managing-users-and-groups/authentication-mode.rst" class="fa fa-github"> Edit on GitHub</a>
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="authentication-mode">
<span id="id1"></span><h1>Рэжым аўтэнтыфікацыі<a class="headerlink" href="#authentication-mode" title="Permalink to this heading">¶</a></h1>
<p>Па змаўчанні каталог выкарыстоўвае ўнутраную базу дадзеных для кіравання карыстальнікамі і аўтэнтыфікацыі. Аднак ёсць некаторыя іншыя даступныя механізмы аўтэнтыфікацыі:</p>
<ul class="simple">
<li><p><a class="reference internal" href="#authentication-ldap"><span class="std std-ref">Налада LDAP</span></a></p></li>
<li><p><a class="reference internal" href="#authentication-ldap-hierarchy"><span class="std std-ref">Configuring LDAP - Hierarchy</span></a></p></li>
<li><p><a class="reference internal" href="#authentication-cas"><span class="std std-ref">Налада CAS</span></a></p></li>
<li><p><a class="reference internal" href="#authentication-keycloak"><span class="std std-ref">Configuring Keycloak</span></a></p></li>
<li><p><a class="reference internal" href="#authentication-shibboleth"><span class="std std-ref">Налада Shibboleth</span></a></p></li>
</ul>
<p>Which mode to use is configured in <code class="file docutils literal notranslate"><span class="pre">WEB-INF/config-security/config-security.xml</span></code> or via an environment variable <code class="docutils literal notranslate"><span class="pre">geonetwork.security.type</span></code>.</p>
<p>Uncomment the relevant line in <code class="file docutils literal notranslate"><span class="pre">WEB-INF/config-security/config-security.xml</span></code>:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;import</span><span class="w"> </span><span class="na">resource=</span><span class="s">&quot;config-security-{mode}.xml&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<section id="configuring-ldap">
<span id="authentication-ldap"></span><h2>Налада LDAP<a class="headerlink" href="#configuring-ldap" title="Permalink to this heading">¶</a></h2>
<p><a class="reference external" href="https://en.wikipedia.org/wiki/Ldap">Lightweight Directory Access Protocol (LDAP)</a> enables GeoNetwork to verify usernames and passwords to a remote identity store.
LDAP implementation uses the default GeoNetwork Login User Interface elements.</p>
<p>GeoNetwork currently has 2 approaches to configure LDAP. Verify also the alternative approach in <a class="reference internal" href="#authentication-ldap-hierarchy"><span class="std std-ref">Configuring LDAP - Hierarchy</span></a>.</p>
<p>The LDAP configuration is defined in <code class="docutils literal notranslate"><span class="pre">WEB-INF/config-security/config-security.properties</span></code>, you can then configure
your environment updating the previous file or overriding the properties in the file
<code class="docutils literal notranslate"><span class="pre">WEB-INF/config-security/config-security-overrides.properties</span></code>.</p>
<ol class="arabic">
<li><p>Define the LDAP connection:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ldap.base.provider.url</span></code>: This tells the portal where the LDAP server is located. Make sure that the computer with the catalog can hit the computer with the LDAP server. Check to make sure that the appropriate ports are opened, etc.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ldap.base.dn</span></code>: this will usually look something like: &quot;dc=[organizationnamehere],dc=org&quot;</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ldap.security.principal</span></code> / <code class="docutils literal notranslate"><span class="pre">ldap.security.credentials</span></code>: Define LDAP administrator user to use to bind to LDAP. If not define, an anonymous bind is made. Principal is the username and credentials property the password.</p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># LDAP security properties
ldap.base.provider.url=ldap://localhost:389
ldap.base.dn=dc=fao,dc=org
ldap.security.principal=cn=admin,dc=fao,dc=org
ldap.security.credentials=ldap
</pre></div>
</div>
<p>To verify that you have the correct settings, try to connect to the LDAP server using an LDAP browser application.</p>
</div></blockquote>
</li>
<li><p>Define where to find users in LDAP structure for authentication:</p>
<blockquote>
<div><ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">ldap.base.search.base</span></code>: this is where the catalog will look for users for authentication.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">ldap.base.dn.pattern</span></code>: this is the distinguished name for the user to bind with. {0} is replaced by the user name typed in the sign in screen.</p></li>
</ul>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ldap.base.search.base=ou=people
ldap.base.dn.pattern=uid={0},${ldap.base.search.base}
#ldap.base.dn.pattern=mail={0},${ldap.base.search.base}
</pre></div>
</div>
</div></blockquote>
</li>
</ol>
<section id="authorization-settings">
<h3>Authorization Settings<a class="headerlink" href="#authorization-settings" title="Permalink to this heading">¶</a></h3>
<p>When using LDAP, the user information and privileges for GeoNetwork could be defined from the LDAP attributes.</p>
<section id="user-information">
<h4>User information<a class="headerlink" href="#user-information" title="Permalink to this heading">¶</a></h4>
<p>The user information could be retrieved from the LDAP configuring for each user attribute in the catalog database which LDAP attributes match.
If the attribute is empty or not defined, a default value could be defined. The property value is composed by two parts separated by <code class="docutils literal notranslate"><span class="pre">,</span></code> character.
The first part is the attribute name and the second part is the default value in case the attribute name is not define or the attribute value in LDAP is empty.</p>
<p>The configuration is the following:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># Map user information to LDAP attributes and default values
# ldapUserContextMapper.mapping[name]=ldap_attribute,default_value
ldapUserContextMapper.mapping[name]=cn,
ldapUserContextMapper.mapping[surname]=givenName,
ldapUserContextMapper.mapping[mail]=mail,data@myorganization.org
ldapUserContextMapper.mapping[organisation]=,myorganization
ldapUserContextMapper.mapping[kind]=,
ldapUserContextMapper.mapping[address]=,
ldapUserContextMapper.mapping[zip]=,
ldapUserContextMapper.mapping[state]=,
ldapUserContextMapper.mapping[city]=,
ldapUserContextMapper.mapping[country]=,
</pre></div>
</div>
</section>
<section id="privileges-configuration">
<h4>Privileges configuration<a class="headerlink" href="#privileges-configuration" title="Permalink to this heading">¶</a></h4>
<p>User groups and user profiles could be set optionally from LDAP information or not. By default user privileges are managed from the local database.
If LDAP information should be used to define user privileges, set the <code class="docutils literal notranslate"><span class="pre">ldap.privilege.import</span></code> property <code class="docutils literal notranslate"><span class="pre">true</span></code>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ldap.privilege.import=true
</pre></div>
</div>
<p>When importing privileges from LDAP, the catalog administrator could decide to create groups defined in the LDAP and not defined in local database. For this set the following property to true:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ldap.privilege.create.nonexisting.groups=false
</pre></div>
</div>
<p>In order to define which groups the user is member of and which profile is the user:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ldapUserContextMapper.mapping[privilege]=groups,sample
# If not set, the default profile is RegisteredUser
# Valid profiles are http://geonetwork-opensource.org/manuals/trunk/eng/developer/apidocs/geonetwork/org/fao/geonet/constants/Geonet.Profile.html
ldapUserContextMapper.mapping[profile]=privileges,RegisteredUser
</pre></div>
</div>
<p>Attributes configuration:</p>
<blockquote>
<div><ul class="simple">
<li><p>privilege attribute contains the group this user is member of. More than one group is allowed.</p></li>
<li><p>profile attribute contains the profile of the user.</p></li>
</ul>
</div></blockquote>
<p>User valid profiles are:</p>
<blockquote>
<div><ul class="simple">
<li><p>Administrator</p></li>
<li><p>UserAdmin</p></li>
<li><p>Reviewer</p></li>
<li><p>Editor</p></li>
<li><p>RegisteredUser</p></li>
<li><p>Guest</p></li>
</ul>
</div></blockquote>
<p>If LDAP attribute containing profiles does not match the catalog profile list, a mapping could be defined:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># Map LDAP custom profiles to catalog profiles. Not used if ldap.privilege.pattern is defined.
ldapUserContextMapper.profileMapping[Admin]=Administrator
ldapUserContextMapper.profileMapping[Editor]=Reviewer
ldapUserContextMapper.profileMapping[Public]=RegisteredUser
</pre></div>
</div>
<p>For example, in the previous configuration, the attribute value <code class="docutils literal notranslate"><span class="pre">Admin</span></code> will be mapped to <code class="docutils literal notranslate"><span class="pre">Administrator</span></code> (which is a valid profile for the catalog).</p>
<p>An attribute could define both the profile and the group for a user. To extract this information, a custom pattern could be defined to populate user privileges according to that attribute:</p>
<ol class="arabic simple">
<li><p>Define one attribute for the profile and one for groups in <code class="docutils literal notranslate"><span class="pre">WEB-INF/config-security/config-security-overrides.properties</span></code></p></li>
</ol>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># In config-security-overrides.properties
ldapUserContextMapper.mapping[privilege]=cat_privileges,sample
</pre></div>
</div>
<ol class="arabic simple" start="2">
<li><p>Define one attribute for the privilege and define a custom pattern:</p></li>
</ol>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># In config-security.properties
ldap.privilege.pattern=CAT_(.*)_(.*)
ldap.privilege.pattern.idx.group=1
ldap.privilege.pattern.idx.profil=2
</pre></div>
</div>
<p>Enable the bean <cite>ldapUserContextMapper</cite> for  <cite>LDAPUserDetailsContextMapperWithPattern`</cite> in <code class="docutils literal notranslate"><span class="pre">WEB-INF/config-security/config-security-ldap.xml</span></code>).</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="w">  </span><span class="cm">&lt;!--&lt;bean id=&quot;ldapUserContextMapper&quot;</span>
<span class="cm">      class=&quot;org.fao.geonet.kernel.security.ldap.LDAPUserDetailsContextMapper&quot;&gt;</span>
<span class="cm">      &lt;property name=&quot;mapping&quot;&gt;</span>
<span class="cm">        &lt;map/&gt;</span>
<span class="cm">      &lt;/property&gt;</span>
<span class="cm">      &lt;property name=&quot;profileMapping&quot;&gt;</span>
<span class="cm">        &lt;map/&gt;</span>
<span class="cm">      &lt;/property&gt;</span>
<span class="cm">      &lt;property name=&quot;ldapBaseDn&quot; value=&quot;${ldap.base.dn}&quot;/&gt;</span>
<span class="cm">      &lt;property name=&quot;importPrivilegesFromLdap&quot; value=&quot;${ldap.privilege.import}&quot;/&gt;</span>
<span class="cm">      &lt;property name=&quot;createNonExistingLdapGroup&quot;</span>
<span class="cm">                value=&quot;${ldap.privilege.create.nonexisting.groups}&quot;/&gt;</span>
<span class="cm">      &lt;property name=&quot;createNonExistingLdapUser&quot; value=&quot;${ldap.privilege.create.nonexisting.users}&quot;/&gt;</span>
<span class="cm">      &lt;property name=&quot;ldapManager&quot; ref=&quot;ldapUserDetailsService&quot;/&gt;</span>
<span class="cm">      &lt;property name=&quot;contextSource&quot; ref=&quot;contextSource&quot;/&gt;</span>
<span class="cm">      &lt;property name=&quot;ldapUsernameCaseInsensitive&quot; value=&quot;${ldap.usernameCaseInsensitive:#{true}}&quot;/&gt;</span>
<span class="cm">  &lt;/bean&gt;--&gt;</span>

<span class="w">  </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;ldapUserContextMapper&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.fao.geonet.kernel.security.ldap.LDAPUserDetailsContextMapperWithPattern&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;mapping&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;map/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/property&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;profileMapping&quot;</span><span class="nt">&gt;</span>
<span class="w">        </span><span class="nt">&lt;map/&gt;</span>
<span class="w">    </span><span class="nt">&lt;/property&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;importPrivilegesFromLdap&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${ldap.privilege.import}&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;createNonExistingLdapGroup&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${ldap.privilege.create.nonexisting.groups}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;createNonExistingLdapUser&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${ldap.privilege.create.nonexisting.users}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;ldapManager&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;ldapUserDetailsService&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;privilegePattern&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${ldap.privilege.pattern}&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;groupIndexInPattern&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${ldap.privilege.pattern.idx.group}&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;profilIndexInPattern&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;${ldap.privilege.pattern.idx.profil}&quot;</span><span class="nt">/&gt;</span>

<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;contextSource&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;contextSource&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
<ol class="arabic simple" start="3">
<li><p>Define custom location for extracting group and role (no support for group/role combination) (use LDAPUserDetailsContextMapperWithProfileSearch in config-security.xml).</p></li>
</ol>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ldap.privilege.search.group.attribute=cn
ldap.privilege.search.group.object=ou=groups
#ldap.privilege.search.group.query=(&amp;(objectClass=*)(memberUid=uid={0},${ldap.base.search.base},${ldap.base.dn})(cn=EL_*))
ldap.privilege.search.group.queryprop=memberuid
ldap.privilege.search.group.query=(&amp;(objectClass=*)(memberUid=uid={0},${ldap.base.search.base},${ldap.base.dn})(|(cn=SP_*)(cn=EL_*)))
ldap.privilege.search.group.pattern=EL_(.*)
ldap.privilege.search.privilege.attribute=cn
ldap.privilege.search.privilege.object=ou=groups
ldap.privilege.search.privilege.query=(&amp;(objectClass=*)(memberUid=uid={0},${ldap.base.search.base},${ldap.base.dn})(cn=SV_*))
ldap.privilege.search.privilege.pattern=SV_(.*)
</pre></div>
</div>
<p>The LDAP attribute can contains the following configuration to define the different type of users, for example:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>cat_privileges=CAT_ALL_Administrator

-- Define a reviewer for the group GRANULAT
cat_privileges=CAT_GRANULAT_Reviewer

-- Define a reviewer for the group GRANULAT and editor for MIMEL
cat_privileges=CAT_GRANULAT_Reviewer
cat_privileges=CAT_MIMEL_Editor

-- Define a reviewer for the group GRANULAT and editor for MIMEL and RegisteredUser for NATURA2000
cat_privileges=CAT_GRANULAT_Reviewer
cat_privileges=CAT_MIMEL_Reviewer
cat_privileges=CAT_NATURA2000_RegisteredUser

-- Only a registered user for GRANULAT
cat_privileges=CAT_GRANULAT_RegisteredUser
</pre></div>
</div>
</section>
<section id="synchronization">
<h4>Synchronization<a class="headerlink" href="#synchronization" title="Permalink to this heading">¶</a></h4>
<p>A synchronization task is taking care of removing LDAP users that may be deleted. For example:</p>
<ul>
<li><p>T0: User A signs in to the catalog. A local user A is created in the user database.</p></li>
<li><p>T1: User A is deleted from the LDAP (User A cannot sign in to the catalog anymore).</p></li>
<li><p>T2: The synchronization task will check that all local LDAP users exist in LDAP:</p>
<blockquote>
<div><ul class="simple">
<li><p>If the user does not own any records, it will be deleted.</p></li>
<li><p>If the user owns metadata records, a warning message will be written to the catalog logging system. The owner of the record should be changed to another user before the task can remove the current owner.</p></li>
</ul>
</div></blockquote>
</li>
</ul>
<p>By default the task runs once every day. This can be changed in the following property:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span># Run LDAP sync every day at 23:30
ldap.sync.cron=0 30 23 * * ?
</pre></div>
</div>
<p>The following properties allow advanced configuration of the synchronisation process:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>ldap.sync.user.search.base=${ldap.base.search.base}
ldap.sync.user.search.filter=(&amp;(objectClass=*)(mail=*@*)(givenName=*))
ldap.sync.user.search.attribute=uid
ldap.sync.group.search.base=ou=groups
ldap.sync.group.search.filter=(&amp;(objectClass=posixGroup)(cn=EL_*))
ldap.sync.group.search.attribute=cn
ldap.sync.group.search.pattern=EL_(.*)
</pre></div>
</div>
</section>
<section id="debugging">
<h4>Debugging<a class="headerlink" href="#debugging" title="Permalink to this heading">¶</a></h4>
<p>If the connection fails, try to increase the logging level for LDAP in <code class="docutils literal notranslate"><span class="pre">WEB-INF/classes/log4j.xml</span></code>:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;logger</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;geonetwork.ldap&quot;</span><span class="w"> </span><span class="na">additivity=</span><span class="s">&quot;false&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;level</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;DEBUG&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/logger&gt;</span>
</pre></div>
</div>
<p>Or from the Configuration Settings set the <code class="docutils literal notranslate"><span class="pre">Log</span> <span class="pre">level</span></code> to <code class="docutils literal notranslate"><span class="pre">DEV</span></code> temporarily:</p>
<figure class="align-default">
<img alt="../../_images/setting-log-level.png" src="../../_images/setting-log-level.png" />
</figure>
</section>
</section>
</section>
<section id="configuring-ldap-hierarchy">
<span id="authentication-ldap-hierarchy"></span><h2>Configuring LDAP - Hierarchy<a class="headerlink" href="#configuring-ldap-hierarchy" title="Permalink to this heading">¶</a></h2>
<p>A slightly different method for LDAP configuration was introduced in mid-2020.</p>
<p>This extends the original configuration infrastructure (original configurations still work without any changes).</p>
<p>Before you start configuring, you will need to know;</p>
<ol class="arabic simple">
<li><p>URL to your LDAP Server</p></li>
<li><p>Username/password to login to the LDAP Server (to execute queries)</p></li>
<li><p>LDAP query to find a user (given what they type in on the login screen)</p></li>
<li><p>Details of how to convert the LDAP user's attributes to GeoNetwork user attributes</p></li>
<li><p>LDAP query to find groups a user is a member of</p></li>
<li><p>How to convert a LDAP group to a GeoNetwork Group/Profile</p></li>
</ol>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>There is a <a class="reference external" href="https://www.youtube.com/watch?v=f8rvbEdnE-g">video developer chat</a> that goes into details for how to configure LDAP including setting up a pre-configured LDAP server (using Apache Directory Studio) for testing/debugging/learning.</p>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Should I use the Hierarchy or Original configuration?</p>
<p>If you already have an existing (Original) configuration, there's no need to move to the new one.  Most of the code between the two is the same.</p>
<p>If you are starting a new configuration, I would recommend the Hierarchy configuration.  It's a little simpler and supported by test cases and test infrastructure.  It also supports LDAPs where users/groups are in multiple directories.</p>
</div>
<section id="configuring-ldap-beans-hierarchy">
<h3>Configuring LDAP Beans (Hierarchy)<a class="headerlink" href="#configuring-ldap-beans-hierarchy" title="Permalink to this heading">¶</a></h3>
<p>GeoNetwork comes with a sample LDAP configuration that you can use in Apache Directory Studio to create the same LDAP server used in the test cases.  There is also a sample GeoNetwork configuration that connects to this LDAP server.  Please see the <a class="reference external" href="https://github.com/geonetwork/core-geonetwork/blob/master/core/src/test/resources/org/fao/geonet/kernel/security/ldap/README.md">README.md</a> or the <a class="reference external" href="https://www.youtube.com/watch?v=f8rvbEdnE-g">video developer chat</a> for instructions.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>To use this configuration, uncomment the &quot;&lt;import resource=&quot;config-security-ldap-recursive.xml&quot;/&gt;&quot; line in <cite>web/src/main/webapp/WEB-INF/config-security/config-security.xml</cite></p>
</div>
<ol class="arabic">
<li><p>Configure the <cite>contextSource</cite> bean with a reference to your LDAP server and a user that can execute LDAP queries.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;contextSource&quot;</span><span class="w">   </span><span class="na">class=</span><span class="s">&quot;org.springframework.security.ldap.DefaultSpringSecurityContextSource&quot;</span><span class="nt">&gt;</span>
<span class="w">    </span><span class="nt">&lt;constructor-arg</span><span class="w"> </span><span class="na">value=</span><span class="s">“ldap://localhost:3333/dc=example,dc=com&quot;/</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;userDn&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;cn=admin,ou=GIS Department,ou=Corporate Users,dc=example,dc=com&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;password&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;admin1&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</li>
<li><p>Configure the <cite>ldapUserSearch</cite> bean with the query used to find the user (given what was typed in the login page).</p>
<p>NOTE: Set <cite>searchSubtree</cite> to <cite>true</cite> to do a recursive search of the LDAP.  Use <cite>searchBase</cite> to control which directory the search starts in (&quot;&quot; means start from the root).</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;ldapUserSearch&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;…&quot;</span><span class="nt">&gt;</span>
<span class="w">   </span><span class="nt">&lt;constructor-arg</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;searchBase&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;&quot;</span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="nt">&lt;constructor-arg</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;searchFilter&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;(sAMAccountName={0})&quot;</span><span class="nt">/&gt;</span>
<span class="w">   </span><span class="nt">&lt;constructor-arg</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;contextSource&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;contextSource&quot;</span><span class="nt">/&gt;</span>

<span class="w">   </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;searchSubtree&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;true&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</li>
<li><p>Configure the <cite>ldapUserContextMapper</cite> bean with how to convert the LDAP user's attributes to GeoNetwork user attributes (see the original configuration documentation, above).</p>
<p>NOTE: The <cite>value</cite> portion has two parts.  The first part is the name of LDAP attribute (can be blank).  The second part is the default value if the LDAP attribute is missing or empty (see the original configuration documentation, above).</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;ldapUserContextMapper&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">“LDAPUserDetailsContextMapperWithProfileSearchEnhanced&quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;mapping&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;map&gt;</span>
<span class="w">        </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;name&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;cn,&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;surname&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;sn,&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;mail&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;mail,&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;organisation&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;,&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;address&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;,&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;zip&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;,&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;state&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;,&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;city&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;,&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;country&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;,&quot;</span><span class="nt">/&gt;</span>

<span class="w">        </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;profile&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;,RegisteredUser&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;privilege&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;,none&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;/map&gt;</span>
<span class="w">    </span><span class="nt">&lt;/property&gt;</span>

<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</li>
<li><p>Continue configuring the <cite>ldapUserContextMapper</cite> bean so the LDAP can also provide group/profile roles for the user.</p>
<p>NOTE: The <cite>ldapMembershipQuery</cite> is the LDAP directory where the membership query will be start (&quot;&quot; means start at the root of the LDAP).</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;ldapUserContextMapper&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;LDAPUserDetailsContextMapperWithProfileSearchEnhanced&quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;importPrivilegesFromLdap&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">“true&quot;/</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="cm">&lt;!-- typically, don&#39;t want GN to modify the LDAP server! --&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;createNonExistingLdapGroup&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;false&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;createNonExistingLdapUser&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;false&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;ldapManager&quot;</span><span class="w"> </span><span class="na">ref=</span><span class="s">&quot;ldapUserDetailsService&quot;</span><span class="w"> </span><span class="nt">/&gt;</span>

<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;membershipSearchStartObject&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;ldapMembershipQuery&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;(&amp;amp;(objectClass=*)(member=cn={2})(cn=GCAT_*))&quot;</span><span class="nt">/&gt;</span>

<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</li>
<li><p>Continue configuring the <cite>ldapUserContextMapper</cite> bean so the LDAP roles can be converted to GeoNetwork Groups/Profiles.</p>
<p>NOTE: You can use multiple <cite>ldapRoleConverters</cite>.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;ldapUserContextMapper&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;LDAPUserDetailsContextMapperWithProfileSearchEnhanced&quot;</span><span class="nt">&gt;</span>

<span class="w">   </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;ldapRoleConverters&quot;</span><span class="nt">&gt;</span>
<span class="w">     </span><span class="nt">&lt;util:list&gt;</span>
<span class="w">       </span><span class="nt">&lt;ref</span><span class="w"> </span><span class="na">bean=</span><span class="s">&quot;ldapRoleConverterGroupNameParser&quot;</span><span class="nt">/&gt;</span>
<span class="w">     </span><span class="nt">&lt;/util:list&gt;</span>
<span class="w">   </span><span class="nt">&lt;/property&gt;</span>

<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</li>
</ol>
<p>There are currently two ways to convert an LDAP group to GeoNetwork Groups/Profiles.</p>
<ul>
<li><p>The <cite>LDAPRoleConverterGroupNameParser</cite>, which works the same as the original LDAP configuration.  It uses a regular expression to parse the LDAP group name into a GeoNetwork Group/Profile.  This will convert the LDAP role <cite>GCAT_GENERAL_EDITOR</cite> into the GeoNetwork group <cite>GENERAL</cite> with Profile <cite>Editor.</cite></p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">&quot;ldapRoleConverterGroupNameParser&quot;</span><span class="w">  </span><span class="na">class=</span><span class="s">&quot;LDAPRoleConverterGroupNameParser&quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;ldapMembershipQueryParser&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;GCAT_(.*)_(.*)&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;groupIndexInPattern&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;1&quot;</span><span class="nt">/&gt;</span>
<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;profileIndexInPattern&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">“2&quot;/</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;profileMapping&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;map&gt;</span>
<span class="w">        </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;ADMIN&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Administrator&quot;</span><span class="nt">/&gt;</span>
<span class="w">        </span><span class="nt">&lt;entry</span><span class="w"> </span><span class="na">key=</span><span class="s">&quot;EDITOR&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Editor&quot;</span><span class="nt">/&gt;</span>
<span class="w">      </span><span class="nt">&lt;/map&gt;</span>
<span class="w">    </span><span class="nt">&lt;/property&gt;</span>

<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</li>
<li><p>There is also a more direct way using <cite>LDAPRoleConverterGroupNameConverter</cite>.  This directly converts the LDAP group name into a list of GeoNetwork Groups/Profiles.</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">id=</span><span class="s">“ldapRoleConverterGroupNameParser&quot;</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;LDAPRoleConverterGroupNameConverter&quot;</span><span class="nt">&gt;</span>

<span class="w">    </span><span class="nt">&lt;property</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;convertMap&quot;</span><span class="nt">&gt;</span>
<span class="w">      </span><span class="nt">&lt;map&gt;</span>

<span class="w">        </span><span class="nt">&lt;entry&gt;</span>
<span class="w">            </span><span class="nt">&lt;key&gt;</span>
<span class="w">                </span><span class="nt">&lt;value&gt;</span>HGIS_GeoNetwork_Admin<span class="nt">&lt;/value&gt;</span>
<span class="w">            </span><span class="nt">&lt;/key&gt;</span>
<span class="w">            </span><span class="nt">&lt;list&gt;</span>

<span class="w">                </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.fao.geonet.kernel.security.ldap.LDAPRole&quot;</span><span class="nt">&gt;</span>
<span class="w">                  </span><span class="nt">&lt;constructor-arg</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;groupName&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;java.lang.String&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;myGroup&quot;</span><span class="nt">/&gt;</span>
<span class="w">                  </span><span class="nt">&lt;constructor-arg</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;profileName&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;java.lang.String&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Administrator&quot;</span><span class="nt">/&gt;</span>
<span class="w">                </span><span class="nt">&lt;/bean&gt;</span>

<span class="w">            </span><span class="nt">&lt;/list&gt;</span>
<span class="w">        </span><span class="nt">&lt;/entry&gt;</span>
<span class="w">        </span><span class="nt">&lt;entry&gt;</span>
<span class="w">          </span><span class="nt">&lt;key&gt;</span>
<span class="w">                </span><span class="nt">&lt;value&gt;</span>HGIS_GeoNetwork_Editor<span class="nt">&lt;/value&gt;</span>
<span class="w">          </span><span class="nt">&lt;/key&gt;</span>
<span class="w">          </span><span class="nt">&lt;list&gt;</span>

<span class="w">            </span><span class="nt">&lt;bean</span><span class="w"> </span><span class="na">class=</span><span class="s">&quot;org.fao.geonet.kernel.security.ldap.LDAPRole&quot;</span><span class="nt">&gt;</span>
<span class="w">              </span><span class="nt">&lt;constructor-arg</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;groupName&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;java.lang.String&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">“myGroup&quot;/</span><span class="nt">&gt;</span>
<span class="w">              </span><span class="nt">&lt;constructor-arg</span><span class="w"> </span><span class="na">name=</span><span class="s">&quot;profileName&quot;</span><span class="w"> </span><span class="na">type=</span><span class="s">&quot;java.lang.String&quot;</span><span class="w"> </span><span class="na">value=</span><span class="s">&quot;Editor&quot;</span><span class="nt">/&gt;</span>
<span class="w">            </span><span class="nt">&lt;/bean&gt;</span>

<span class="w">          </span><span class="nt">&lt;/list&gt;</span>
<span class="w">        </span><span class="nt">&lt;/entry&gt;</span>
<span class="w">      </span><span class="nt">&lt;/map&gt;</span>
<span class="w">    </span><span class="nt">&lt;/property&gt;</span>
<span class="nt">&lt;/bean&gt;</span>
</pre></div>
</div>
</li>
</ul>
</section>
</section>
<section id="configuring-cas">
<span id="authentication-cas"></span><h2>Налада CAS<a class="headerlink" href="#configuring-cas" title="Permalink to this heading">¶</a></h2>
<p>To enable CAS, set up authentication by including <code class="docutils literal notranslate"><span class="pre">WEB-INF/config-security/config-security-cas.xml</span></code>
in <code class="docutils literal notranslate"><span class="pre">WEB-INF/config-security/config-security.xml</span></code>, uncommenting the following lines:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;import</span><span class="w"> </span><span class="na">resource=</span><span class="s">&quot;config-security-cas.xml&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;import</span><span class="w"> </span><span class="na">resource=</span><span class="s">&quot;config-security-cas-ldap.xml&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>CAS can use either LDAP or a database for user management. To use a database uncomment the following lines instead:</p>
<div class="highlight-xml notranslate"><div class="highlight"><pre><span></span><span class="nt">&lt;import</span><span class="w"> </span><span class="na">resource=</span><span class="s">&quot;config-security-cas.xml&quot;</span><span class="nt">/&gt;</span>
<span class="nt">&lt;import</span><span class="w"> </span><span class="na">resource=</span><span class="s">&quot;config-security-cas-database.xml&quot;</span><span class="nt">/&gt;</span>
</pre></div>
</div>
<p>The CAS configuration is defined in <code class="docutils literal notranslate"><span class="pre">WEB-INF/config-security/config-security.properties</span></code>.
You can configure your environment by updating the previous file or by defining property overrides in the file
<code class="docutils literal notranslate"><span class="pre">WEB-INF/config-security/config-security-overrides.properties</span></code>:</p>
<div class="highlight-text notranslate"><div class="highlight"><pre><span></span>cas.baseURL=https://localhost:8443/cas
cas.ticket.validator.url=${cas.baseURL}
cas.login.url=${cas.baseURL}/login
cas.logout.url=${cas.baseURL}/logout?url=${geonetwork.https.url}/
</pre></div>
</div>
</section>
<section id="configuring-keycloak">
<span id="authentication-keycloak"></span><h2>Configuring Keycloak<a class="headerlink" href="#configuring-keycloak" title="Permalink to this heading">¶</a></h2>
<p><a class="reference external" href="https://keycloak.org">Keycloak</a> is a software solution to facilitate storage of authentication details, user federation, identity brokering and social login.
GeoNetwork can be set up to use a keycloak instance for authentication.</p>
<p>Install keycloak from its instructions or use this example setup in docker
<a class="reference external" href="https://www.keycloak.org/getting-started/getting-started-docker">https://www.keycloak.org/getting-started/getting-started-docker</a></p>
<p>Keycloak details are defined via environment variables</p>
<blockquote>
<div><div class="highlight-text notranslate"><div class="highlight"><pre><span></span>KEYCLOAK_AUTH_SERVER_URL={keycloak url}
KEYCLOAK_REALM={realm name}
KEYCLOAK_RESOURCE={client name}
KEYCLOAK_SECRET={client secret}
KEYCLOAK_DISABLE_TRUST_MANAGER={true|false}
</pre></div>
</div>
</div></blockquote>
<p>You can setup more advance keycloak settings by editing the file
<code class="file docutils literal notranslate"><span class="pre">WEB-INF/config-security/keycloak.json</span></code></p>
<section id="geonetwork-client-url-configuration">
<h3>Geonetwork client URL configuration<a class="headerlink" href="#geonetwork-client-url-configuration" title="Permalink to this heading">¶</a></h3>
<p>Ensure that when you configure your client that you setup the valid redirect uris to your geonetwork installation.
i.e. <a class="reference external" href="https://localhost:8443/geonetwork/*">https://localhost:8443/geonetwork/*</a>. If this is not setup correctly you may get and error indicating that a wrong redirect uri was supplied.
Also if wanting to test the client backchannel logout then ensure that the admin URL is also set to the geonetwork installation.</p>
</section>
<section id="sample-user-role-group-setup">
<h3>Sample user/role/group setup<a class="headerlink" href="#sample-user-role-group-setup" title="Permalink to this heading">¶</a></h3>
<section id="sample-role-setup">
<h4>Sample Role setup<a class="headerlink" href="#sample-role-setup" title="Permalink to this heading">¶</a></h4>
<p>In your client role settings (clients -&gt; myclient -&gt; roles). Add the following roles</p>
<blockquote>
<div><div class="highlight-text notranslate"><div class="highlight"><pre><span></span>Administrator
RegisteredUser
Guest
sample:UserAdmin
sample:Reviewer
sample:Editor
sample:RegisteredUser
</pre></div>
</div>
</div></blockquote>
</section>
<section id="sample-group-configuration">
<h4>Sample Group configuration<a class="headerlink" href="#sample-group-configuration" title="Permalink to this heading">¶</a></h4>
<ol class="arabic simple">
<li><p>Go to keycloak groups (left menu).</p></li>
<li><p>Create a new group called &quot;Administrator&quot;</p></li>
<li><p>Edit the group. Go to Role Mappings -&gt; Client Roles (myclient) -&gt; select the administrator roles and click on &quot;Add selected&quot;
Any user joined to the Administrator group will be a geonetwork administrator.</p></li>
</ol>
</section>
<section id="sample-user-configuration">
<h4>Sample User configuration<a class="headerlink" href="#sample-user-configuration" title="Permalink to this heading">¶</a></h4>
<ol class="arabic simple">
<li><p>Go to keycloak users (left menu)</p></li>
<li><p>Add or select existing user. Then go to that user.</p></li>
<li><p>Go to role Mappings -&gt; Client Roles (myclient) -&gt; select the available roles to be applied and click on &quot;Add selected&quot;
or go to Groups -&gt; Available Groups -&gt; Click on the Administrator Group and then click on &quot;Join&quot;</p></li>
</ol>
<p>A similar setup is described for geoserver in the <a class="reference external" href="https://docs.geoserver.org/latest/en/user/community/keycloak/index.html">geoserver documentation</a>.</p>
</section>
</section>
</section>
<section id="configuring-shibboleth">
<span id="authentication-shibboleth"></span><h2>Налада Shibboleth<a class="headerlink" href="#configuring-shibboleth" title="Permalink to this heading">¶</a></h2>
<p>The catalog can operate in a SAML secured federation. Shibboleth should be installed
in Apache as described <a class="reference external" href="https://wiki.shibboleth.net/confluence/display/SHIB2/Installation">here</a>.
The catalog is accessed via Apache. Setup Shibboleth authentication by including <code class="docutils literal notranslate"><span class="pre">WEB-INF/config-security/config-security-shibboleth.xml</span></code>
in <code class="docutils literal notranslate"><span class="pre">WEB-INF/config-security/config-security.xml</span></code>. You can then configure your environment in <code class="docutils literal notranslate"><span class="pre">config-security-shibboleth-overrides.properties</span></code>.</p>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="user-self-registration.html" class="btn btn-neutral float-left" title="Самарэгістрацыя карыстальніка" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../managing-classification-systems/index.html" class="btn btn-neutral float-right" title="Кіруючая сістэма класіфікацыі" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2001-2023, GeoNetwork opensource. Licensed under Creative Commons Attribution ShareAlike (Unported) v3.0 License.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>